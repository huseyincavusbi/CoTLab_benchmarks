============================================================
Configuration:
============================================================
backend:
  _target_: cotlab.backends.TransformersBackend
  device: cuda
  dtype: bfloat16
  enable_hooks: true
  trust_remote_code: true
model:
  name: google/medgemma-27b-text-it
  variant: 27b-text
  max_new_tokens: 512
  temperature: 0.7
  top_p: 0.9
  safe_name: medgemma_27b_text_it
prompt:
  _target_: cotlab.prompts.mcq.MCQPromptStrategy
  name: mcq
  few_shot: true
  output_format: json
  answer_first: false
  contrarian: false
dataset:
  _target_: cotlab.datasets.loaders.MedBulletsDataset
  name: medbullets
  split: op5_test
experiment:
  _target_: cotlab.experiments.ActivationCompareExperiment
  name: activation_compare
  description: Collect mean layer activations for representational comparison
  layer_stride: 1
  num_samples: null
  pooling: last_token
  max_input_tokens: 1024
  seed: 42
  answer_cue: '


    Answer:'
  batch_size: 4
seed: 42
verbose: true
dry_run: false

============================================================
Created experiment documentation: /home/ubuntu/CoTLab/outputs/2026-02-26/18-07-07_activation_compare_medgemma_27b_text_it_mcq_json_medbullets/EXPERIMENT.md
Loading backend: cotlab.backends.TransformersBackend
Loading model: google/medgemma-27b-text-it
  Device map: cuda
  Dtype: torch.bfloat16
  Cache: ~/.cache/huggingface (HF default)
Loading checkpoint shards:   0%|                                           | 0/11 [00:00<?, ?it/s]Loading checkpoint shards:   9%|███▏                               | 1/11 [00:00<00:07,  1.42it/s]Loading checkpoint shards:  18%|██████▎                            | 2/11 [00:01<00:06,  1.41it/s]Loading checkpoint shards:  27%|█████████▌                         | 3/11 [00:02<00:05,  1.40it/s]Loading checkpoint shards:  36%|████████████▋                      | 4/11 [00:02<00:05,  1.39it/s]Loading checkpoint shards:  45%|███████████████▉                   | 5/11 [00:03<00:04,  1.42it/s]Loading checkpoint shards:  55%|███████████████████                | 6/11 [00:04<00:03,  1.43it/s]Loading checkpoint shards:  64%|██████████████████████▎            | 7/11 [00:04<00:02,  1.41it/s]Loading checkpoint shards:  73%|█████████████████████████▍         | 8/11 [00:05<00:02,  1.40it/s]Loading checkpoint shards:  82%|████████████████████████████▋      | 9/11 [00:06<00:01,  1.42it/s]Loading checkpoint shards:  91%|██████████████████████████████▉   | 10/11 [00:07<00:00,  1.44it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.47it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.43it/s]
  Resolved device: cuda:0
Creating prompt strategy: mcq
Loading dataset: medbullets
medbullets/op5_test-00000-of-00001.parqu(…):   0%|                     | 0.00/606k [00:00<?, ?B/s]medbullets/op5_test-00000-of-00001.parqu(…):   0%|                     | 0.00/606k [00:00<?, ?B/s]medbullets/op5_test-00000-of-00001.parqu(…):  22%|███           | 131k/606k [00:00<00:00, 776kB/s]medbullets/op5_test-00000-of-00001.parqu(…):  36%|█████         | 220k/606k [00:00<00:00, 824kB/s]medbullets/op5_test-00000-of-00001.parqu(…): 100%|██████████████| 606k/606k [00:00<00:00, 957kB/s]
Creating experiment: activation_compare
============================================================
Running experiment: activation_compare
============================================================
Model : google/medgemma-27b-text-it
Layers (62): [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61]
Pooling: last_token
Batch size: 4
Samples: 308

Activation collect:   0%|                                                  | 0/77 [00:00<?, ?it/s]Activation collect:   1%|▌                                         | 1/77 [00:01<01:23,  1.10s/it]Activation collect:   3%|█                                         | 2/77 [00:01<01:02,  1.20it/s]Activation collect:   4%|█▋                                        | 3/77 [00:02<00:57,  1.29it/s]Activation collect:   5%|██▏                                       | 4/77 [00:03<00:52,  1.39it/s]Activation collect:   6%|██▋                                       | 5/77 [00:03<00:50,  1.43it/s]Activation collect:   8%|███▎                                      | 6/77 [00:04<00:47,  1.49it/s]Activation collect:   9%|███▊                                      | 7/77 [00:05<00:46,  1.50it/s]Activation collect:  10%|████▎                                     | 8/77 [00:05<00:45,  1.50it/s]Activation collect:  12%|████▉                                     | 9/77 [00:06<00:46,  1.47it/s]Activation collect:  13%|█████▎                                   | 10/77 [00:07<00:44,  1.50it/s]Activation collect:  14%|█████▊                                   | 11/77 [00:07<00:45,  1.45it/s]Activation collect:  16%|██████▍                                  | 12/77 [00:08<00:44,  1.45it/s]Activation collect:  17%|██████▉                                  | 13/77 [00:09<00:44,  1.45it/s]Activation collect:  18%|███████▍                                 | 14/77 [00:09<00:43,  1.46it/s]Activation collect:  19%|███████▉                                 | 15/77 [00:10<00:42,  1.47it/s]Activation collect:  21%|████████▌                                | 16/77 [00:11<00:42,  1.45it/s]Activation collect:  22%|█████████                                | 17/77 [00:11<00:41,  1.43it/s]Activation collect:  23%|█████████▌                               | 18/77 [00:12<00:41,  1.42it/s]Activation collect:  25%|██████████                               | 19/77 [00:13<00:41,  1.41it/s]Activation collect:  26%|██████████▋                              | 20/77 [00:14<00:39,  1.43it/s]Activation collect:  27%|███████████▏                             | 21/77 [00:14<00:38,  1.45it/s]Activation collect:  29%|███████████▋                             | 22/77 [00:15<00:37,  1.46it/s]Activation collect:  30%|████████████▏                            | 23/77 [00:16<00:37,  1.44it/s]Activation collect:  31%|████████████▊                            | 24/77 [00:16<00:37,  1.41it/s]Activation collect:  32%|█████████████▎                           | 25/77 [00:17<00:36,  1.41it/s]Activation collect:  34%|█████████████▊                           | 26/77 [00:18<00:35,  1.44it/s]Activation collect:  35%|██████████████▍                          | 27/77 [00:18<00:34,  1.45it/s]Activation collect:  36%|██████████████▉                          | 28/77 [00:19<00:33,  1.44it/s]Activation collect:  38%|███████████████▍                         | 29/77 [00:20<00:32,  1.47it/s]Activation collect:  39%|███████████████▉                         | 30/77 [00:20<00:32,  1.46it/s]Activation collect:  40%|████████████████▌                        | 31/77 [00:21<00:31,  1.44it/s]Activation collect:  42%|█████████████████                        | 32/77 [00:22<00:30,  1.47it/s]Activation collect:  43%|█████████████████▌                       | 33/77 [00:23<00:30,  1.46it/s]Activation collect:  44%|██████████████████                       | 34/77 [00:23<00:29,  1.44it/s]Activation collect:  45%|██████████████████▋                      | 35/77 [00:24<00:29,  1.41it/s]Activation collect:  47%|███████████████████▏                     | 36/77 [00:25<00:28,  1.42it/s]Activation collect:  48%|███████████████████▋                     | 37/77 [00:25<00:28,  1.43it/s]Activation collect:  49%|████████████████████▏                    | 38/77 [00:26<00:26,  1.48it/s]Activation collect:  51%|████████████████████▊                    | 39/77 [00:27<00:27,  1.40it/s]Activation collect:  52%|█████████████████████▎                   | 40/77 [00:27<00:26,  1.40it/s]Activation collect:  53%|█████████████████████▊                   | 41/77 [00:28<00:26,  1.38it/s]Activation collect:  55%|██████████████████████▎                  | 42/77 [00:29<00:25,  1.39it/s]Activation collect:  56%|██████████████████████▉                  | 43/77 [00:30<00:23,  1.42it/s]Activation collect:  57%|███████████████████████▍                 | 44/77 [00:30<00:22,  1.46it/s]Activation collect:  58%|███████████████████████▉                 | 45/77 [00:31<00:22,  1.44it/s]Activation collect:  60%|████████████████████████▍                | 46/77 [00:32<00:21,  1.47it/s]Activation collect:  61%|█████████████████████████                | 47/77 [00:32<00:20,  1.45it/s]Activation collect:  62%|█████████████████████████▌               | 48/77 [00:33<00:19,  1.46it/s]Activation collect:  64%|██████████████████████████               | 49/77 [00:34<00:19,  1.41it/s]Activation collect:  65%|██████████████████████████▌              | 50/77 [00:34<00:19,  1.41it/s]Activation collect:  66%|███████████████████████████▏             | 51/77 [00:35<00:18,  1.44it/s]Activation collect:  68%|███████████████████████████▋             | 52/77 [00:36<00:17,  1.45it/s]Activation collect:  69%|████████████████████████████▏            | 53/77 [00:36<00:16,  1.48it/s]Activation collect:  70%|████████████████████████████▊            | 54/77 [00:37<00:15,  1.48it/s]Activation collect:  71%|█████████████████████████████▎           | 55/77 [00:38<00:15,  1.44it/s]Activation collect:  73%|█████████████████████████████▊           | 56/77 [00:39<00:14,  1.47it/s]Activation collect:  74%|██████████████████████████████▎          | 57/77 [00:39<00:13,  1.46it/s]Activation collect:  75%|██████████████████████████████▉          | 58/77 [00:40<00:12,  1.49it/s]Activation collect:  77%|███████████████████████████████▍         | 59/77 [00:40<00:11,  1.51it/s]Activation collect:  78%|███████████████████████████████▉         | 60/77 [00:41<00:11,  1.46it/s]Activation collect:  79%|████████████████████████████████▍        | 61/77 [00:42<00:10,  1.48it/s]Activation collect:  81%|█████████████████████████████████        | 62/77 [00:43<00:10,  1.48it/s]Activation collect:  82%|█████████████████████████████████▌       | 63/77 [00:43<00:09,  1.47it/s]Activation collect:  83%|██████████████████████████████████       | 64/77 [00:44<00:09,  1.44it/s]Activation collect:  84%|██████████████████████████████████▌      | 65/77 [00:45<00:08,  1.47it/s]Activation collect:  86%|███████████████████████████████████▏     | 66/77 [00:45<00:07,  1.50it/s]Activation collect:  87%|███████████████████████████████████▋     | 67/77 [00:46<00:06,  1.51it/s]Activation collect:  88%|████████████████████████████████████▏    | 68/77 [00:47<00:06,  1.50it/s]Activation collect:  90%|████████████████████████████████████▋    | 69/77 [00:47<00:05,  1.53it/s]Activation collect:  91%|█████████████████████████████████████▎   | 70/77 [00:48<00:04,  1.48it/s]Activation collect:  92%|█████████████████████████████████████▊   | 71/77 [00:49<00:03,  1.52it/s]Activation collect:  94%|██████████████████████████████████████▎  | 72/77 [00:49<00:03,  1.51it/s]Activation collect:  95%|██████████████████████████████████████▊  | 73/77 [00:50<00:02,  1.47it/s]Activation collect:  96%|███████████████████████████████████████▍ | 74/77 [00:51<00:02,  1.45it/s]Activation collect:  97%|███████████████████████████████████████▉ | 75/77 [00:51<00:01,  1.43it/s]Activation collect:  99%|████████████████████████████████████████▍| 76/77 [00:52<00:00,  1.42it/s]Activation collect: 100%|█████████████████████████████████████████| 77/77 [00:53<00:00,  1.42it/s]Activation collect: 100%|█████████████████████████████████████████| 77/77 [00:53<00:00,  1.44it/s]

============================================================
ACTIVATION COLLECT SUMMARY
============================================================
Processed samples : 308 / 308
 Layer        Norm         Std
--------------------------------
     0      221.40    0.052145
     1       26.40    0.012017
     2       62.57    0.012296
     3       54.83    0.028451
     4      394.80    0.019182
     5       89.68    0.012881
     6       68.81    0.025205
     7      254.04    0.032138
     8      728.96    0.058275
     9      873.73    0.073322
    10      317.89    0.075101
    11      265.83    0.059027
    12      155.39    0.042262
    13      289.96    0.067938
    14      261.77    0.097845
    15      661.74    0.127610
    16      508.69    0.151569
    17     1370.32    0.218351
    18      422.32    0.247419
    19      430.38    0.316778
    20      535.21    0.453701
    21     1216.81    0.632238
    22      800.46    0.763651
    23     1134.21    0.937485
    24     1210.07    1.341202
    25     2564.76    1.705934
    26     1746.93    2.264229
    27     3432.20    2.657964
    28     3397.88    2.959502
    29     4349.18    3.546172
    30     5294.78    3.729598
    31     2582.68    3.409832
    32     2562.01    3.770102
    33     2715.21    3.246706
    34     3765.50    3.811115
    35     3326.24    5.278333
    36     5401.33    6.604999
    37     3742.69    5.308605
    38     3442.80    5.761787
    39     4506.28    7.530250
    40     4005.72    6.572669
    41     3720.28    5.513095
    42     3097.48    6.681477
    43     3862.48    8.012096
    44     3489.11    7.630662
    45     4292.44    9.060596
    46     5192.48   10.419409
    47     2178.71    5.035975
    48     4196.67    9.634584
    49     3848.63    8.051735
    50     3926.42    8.481786
    51     2516.06    6.858174
    52     8137.34   14.483772
    53     6541.01   14.874250
    54     5092.34   11.070693
    55    12589.60   24.579067
    56    12174.65   24.495195
    57    16112.63   29.302589
    58    21164.67   38.819191
    59    12149.80   34.324150
    60    10973.36   23.961346
    61    40065.20   17.765326
============================================================

Results saved to: /home/ubuntu/CoTLab/outputs/2026-02-26/18-07-07_activation_compare_medgemma_27b_text_it_mcq_json_medbullets/results.json

Metrics:
  num_samples: 308
  pooling: last_token
  layer_stride: 1
  activation_norms: {0: 221.3981, 1: 26.4028, 2: 62.5729, 3: 54.8277, 4: 394.7964, 5: 89.6838, 6: 68.8073, 7: 254.0382, 8: 728.9638, 9: 873.7281, 10: 317.8902, 11: 265.8304, 12: 155.3901, 13: 289.9635, 14: 261.7685, 15: 661.7365, 16: 508.6946, 17: 1370.3169, 18: 422.3201, 19: 430.3761, 20: 535.214, 21: 1216.8104, 22: 800.4551, 23: 1134.212, 24: 1210.0735, 25: 2564.762, 26: 1746.9326, 27: 3432.2021, 28: 3397.8821, 29: 4349.1758, 30: 5294.7788, 31: 2582.6807, 32: 2562.0142, 33: 2715.2122, 34: 3765.5046, 35: 3326.2427, 36: 5401.3306, 37: 3742.6868, 38: 3442.7998, 39: 4506.2798, 40: 4005.7168, 41: 3720.2815, 42: 3097.4753, 43: 3862.4756, 44: 3489.1064, 45: 4292.4404, 46: 5192.4834, 47: 2178.71, 48: 4196.6694, 49: 3848.6294, 50: 3926.4153, 51: 2516.0566, 52: 8137.3438, 53: 6541.0083, 54: 5092.3438, 55: 12589.5986, 56: 12174.6504, 57: 16112.6299, 58: 21164.668, 59: 12149.7959, 60: 10973.3604, 61: 40065.2031}
  activation_std: {0: 0.052145, 1: 0.012017, 2: 0.012296, 3: 0.028451, 4: 0.019182, 5: 0.012881, 6: 0.025205, 7: 0.032138, 8: 0.058275, 9: 0.073322, 10: 0.075101, 11: 0.059027, 12: 0.042262, 13: 0.067938, 14: 0.097845, 15: 0.12761, 16: 0.151569, 17: 0.218351, 18: 0.247419, 19: 0.316778, 20: 0.453701, 21: 0.632238, 22: 0.763651, 23: 0.937485, 24: 1.341202, 25: 1.705934, 26: 2.264229, 27: 2.657964, 28: 2.959502, 29: 3.546172, 30: 3.729598, 31: 3.409832, 32: 3.770102, 33: 3.246706, 34: 3.811115, 35: 5.278333, 36: 6.604999, 37: 5.308605, 38: 5.761787, 39: 7.53025, 40: 6.572669, 41: 5.513095, 42: 6.681477, 43: 8.012096, 44: 7.630662, 45: 9.060596, 46: 10.419409, 47: 5.035975, 48: 9.634584, 49: 8.051735, 50: 8.481786, 51: 6.858174, 52: 14.483772, 53: 14.87425, 54: 11.070693, 55: 24.579067, 56: 24.495195, 57: 29.302589, 58: 38.819191, 59: 34.32415, 60: 23.961346, 61: 17.765326}

Experiment documentation updated: /home/ubuntu/CoTLab/outputs/2026-02-26/18-07-07_activation_compare_medgemma_27b_text_it_mcq_json_medbullets/EXPERIMENT.md

Experiment complete.
