============================================================
Configuration:
============================================================
backend:
  _target_: cotlab.backends.TransformersBackend
  device: cuda
  dtype: bfloat16
  enable_hooks: true
  trust_remote_code: true
model:
  name: google/medgemma-27b-text-it
  variant: 27b-text
  max_new_tokens: 512
  temperature: 0.7
  top_p: 0.9
  safe_name: medgemma_27b_text_it
prompt:
  _target_: cotlab.prompts.RadiologyPromptStrategy
  name: radiology
  contrarian: false
  few_shot: true
  answer_first: false
  output_format: json
dataset:
  _target_: cotlab.datasets.RadiologyDataset
  name: radiology
  path: data/radiology.json
experiment:
  _target_: cotlab.experiments.ActivationPatchingExperiment
  name: activation_patching
  description: Layer-wise causal activation patching (logit recovery)
  patching_mode: introspect_contrast
  layer_stride: 2
  num_samples: 50
  max_input_tokens: 1024
  seed: 42
  answer_cue: '


    Answer:'
  introspect_instruction: Think deeply about this problem. Carefully reason through
    the underlying mechanisms and consider all relevant factors before committing
    to your answer.
seed: 42
verbose: true
dry_run: false

============================================================
Created experiment documentation: /home/ubuntu/CoTLab/outputs/2026-02-26/19-46-37_activation_patching_medgemma_27b_text_it_radiology_json_radiology/EXPERIMENT.md
Loading backend: cotlab.backends.TransformersBackend
Loading model: google/medgemma-27b-text-it
  Device map: cuda
  Dtype: torch.bfloat16
  Cache: ~/.cache/huggingface (HF default)
Loading checkpoint shards:   0%|                                           | 0/11 [00:00<?, ?it/s]Loading checkpoint shards:   9%|███▏                               | 1/11 [00:00<00:07,  1.42it/s]Loading checkpoint shards:  18%|██████▎                            | 2/11 [00:01<00:06,  1.41it/s]Loading checkpoint shards:  27%|█████████▌                         | 3/11 [00:02<00:05,  1.41it/s]Loading checkpoint shards:  36%|████████████▋                      | 4/11 [00:02<00:05,  1.40it/s]Loading checkpoint shards:  45%|███████████████▉                   | 5/11 [00:03<00:04,  1.42it/s]Loading checkpoint shards:  55%|███████████████████                | 6/11 [00:04<00:03,  1.43it/s]Loading checkpoint shards:  64%|██████████████████████▎            | 7/11 [00:04<00:02,  1.40it/s]Loading checkpoint shards:  73%|█████████████████████████▍         | 8/11 [00:05<00:02,  1.40it/s]Loading checkpoint shards:  82%|████████████████████████████▋      | 9/11 [00:06<00:01,  1.42it/s]Loading checkpoint shards:  91%|██████████████████████████████▉   | 10/11 [00:07<00:00,  1.43it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.47it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.43it/s]
  Resolved device: cuda:0
Creating prompt strategy: radiology
Loading dataset: radiology
Creating experiment: activation_patching
============================================================
Running experiment: activation_patching
============================================================
Model        : google/medgemma-27b-text-it
Patching mode: introspect_contrast
Layers (31): [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60]
Stride : 2  |  max_input_tokens: 1024
Samples: 50  (each requires 33 forward passes)

Activation patching:   0%|                                                 | 0/50 [00:00<?, ?it/s]Activation patching:   2%|▊                                        | 1/50 [00:04<03:21,  4.12s/it]Activation patching:   4%|█▋                                       | 2/50 [00:07<03:00,  3.75s/it]Activation patching:   6%|██▍                                      | 3/50 [00:11<02:59,  3.82s/it]Activation patching:   8%|███▎                                     | 4/50 [00:15<02:57,  3.85s/it]Activation patching:  10%|████                                     | 5/50 [00:19<02:52,  3.84s/it]Activation patching:  12%|████▉                                    | 6/50 [00:23<02:49,  3.85s/it]Activation patching:  14%|█████▋                                   | 7/50 [00:26<02:41,  3.76s/it]Activation patching:  16%|██████▌                                  | 8/50 [00:30<02:34,  3.67s/it]Activation patching:  18%|███████▍                                 | 9/50 [00:33<02:28,  3.63s/it]Activation patching:  20%|████████                                | 10/50 [00:37<02:27,  3.70s/it]Activation patching:  22%|████████▊                               | 11/50 [00:41<02:26,  3.75s/it]Activation patching:  24%|█████████▌                              | 12/50 [00:45<02:23,  3.77s/it]Activation patching:  26%|██████████▍                             | 13/50 [00:48<02:16,  3.68s/it]Activation patching:  28%|███████████▏                            | 14/50 [00:52<02:14,  3.74s/it]Activation patching:  30%|████████████                            | 15/50 [00:56<02:09,  3.70s/it]Activation patching:  32%|████████████▊                           | 16/50 [01:00<02:07,  3.75s/it]Activation patching:  34%|█████████████▌                          | 17/50 [01:03<02:04,  3.78s/it]Activation patching:  36%|██████████████▍                         | 18/50 [01:07<02:01,  3.81s/it]Activation patching:  38%|███████████████▏                        | 19/50 [01:11<01:58,  3.82s/it]Activation patching:  40%|████████████████                        | 20/50 [01:15<01:51,  3.73s/it]Activation patching:  42%|████████████████▊                       | 21/50 [01:18<01:46,  3.67s/it]Activation patching:  44%|█████████████████▌                      | 22/50 [01:22<01:41,  3.62s/it]Activation patching:  46%|██████████████████▍                     | 23/50 [01:25<01:36,  3.58s/it]Activation patching:  48%|███████████████████▏                    | 24/50 [01:29<01:35,  3.66s/it]Activation patching:  50%|████████████████████                    | 25/50 [01:33<01:31,  3.64s/it]Activation patching:  52%|████████████████████▊                   | 26/50 [01:36<01:29,  3.71s/it]Activation patching:  54%|█████████████████████▌                  | 27/50 [01:40<01:26,  3.75s/it]Activation patching:  56%|██████████████████████▍                 | 28/50 [01:44<01:21,  3.69s/it]Activation patching:  58%|███████████████████████▏                | 29/50 [01:48<01:18,  3.74s/it]Activation patching:  60%|████████████████████████                | 30/50 [01:52<01:16,  3.80s/it]Activation patching:  62%|████████████████████████▊               | 31/50 [01:56<01:12,  3.82s/it]Activation patching:  64%|█████████████████████████▌              | 32/50 [01:59<01:06,  3.72s/it]Activation patching:  66%|██████████████████████████▍             | 33/50 [02:03<01:03,  3.76s/it]Activation patching:  68%|███████████████████████████▏            | 34/50 [02:06<00:58,  3.68s/it]Activation patching:  70%|████████████████████████████            | 35/50 [02:10<00:55,  3.73s/it]Activation patching:  72%|████████████████████████████▊           | 36/50 [02:14<00:52,  3.78s/it]Activation patching:  74%|█████████████████████████████▌          | 37/50 [02:18<00:49,  3.81s/it]Activation patching:  76%|██████████████████████████████▍         | 38/50 [02:22<00:47,  3.92s/it]Activation patching:  78%|███████████████████████████████▏        | 39/50 [02:26<00:42,  3.88s/it]Activation patching:  80%|████████████████████████████████        | 40/50 [02:29<00:37,  3.76s/it]Activation patching:  82%|████████████████████████████████▊       | 41/50 [02:33<00:34,  3.81s/it]Activation patching:  84%|█████████████████████████████████▌      | 42/50 [02:37<00:30,  3.84s/it]Activation patching:  86%|██████████████████████████████████▍     | 43/50 [02:41<00:26,  3.74s/it]Activation patching:  88%|███████████████████████████████████▏    | 44/50 [02:45<00:22,  3.78s/it]Activation patching:  90%|████████████████████████████████████    | 45/50 [02:48<00:18,  3.73s/it]Activation patching:  92%|████████████████████████████████████▊   | 46/50 [02:52<00:15,  3.77s/it]Activation patching:  94%|█████████████████████████████████████▌  | 47/50 [02:56<00:11,  3.81s/it]Activation patching:  96%|██████████████████████████████████████▍ | 48/50 [03:00<00:07,  3.73s/it]Activation patching:  98%|███████████████████████████████████████▏| 49/50 [03:03<00:03,  3.70s/it]Activation patching: 100%|████████████████████████████████████████| 50/50 [03:07<00:00,  3.64s/it]Activation patching: 100%|████████████████████████████████████████| 50/50 [03:07<00:00,  3.74s/it]

==============================================================
ACTIVATION PATCHING SUMMARY  (logit-recovery effect)
==============================================================
Processed samples : 50 / 50
Top-5 causal layers: [0, 24, 22, 28, 50]

 Layer   Mean Effect   N samples
----------------------------------
     0        1.6260          50
     2        0.4122          50
     4       -0.2615          50
     6       -0.3312          50
     8        0.3132          50
    10        0.2229          50
    12       -0.0522          50
    14        0.3153          50
    16        0.7181          50
    18        0.3686          50
    20        0.6079          50
    22        0.8566          50
    24        0.9353          50
    26        0.3400          50
    28        0.7799          50
    30        0.4784          50
    32        0.4311          50
    34        0.4154          50
    36       -0.2438          50
    38        0.3652          50
    40        0.4872          50
    42        0.3696          50
    44        0.6771          50
    46        0.3400          50
    48        0.4742          50
    50        0.7659          50
    52       -0.2953          50
    54        0.3297          50
    56        0.3761          50
    58        0.4914          50
    60        0.2446          50
==============================================================

Results saved to: /home/ubuntu/CoTLab/outputs/2026-02-26/19-46-37_activation_patching_medgemma_27b_text_it_radiology_json_radiology/results.json

Metrics:
  num_samples: 50
  layer_stride: 2
  mean_effect_per_layer: {0: 1.626, 2: 0.4122, 4: -0.2615, 6: -0.3312, 8: 0.3132, 10: 0.2229, 12: -0.0522, 14: 0.3153, 16: 0.7181, 18: 0.3686, 20: 0.6079, 22: 0.8566, 24: 0.9353, 26: 0.34, 28: 0.7799, 30: 0.4784, 32: 0.4311, 34: 0.4154, 36: -0.2438, 38: 0.3652, 40: 0.4872, 42: 0.3696, 44: 0.6771, 46: 0.34, 48: 0.4742, 50: 0.7659, 52: -0.2953, 54: 0.3297, 56: 0.3761, 58: 0.4914, 60: 0.2446}
  top_5_causal_layers: [0, 24, 22, 28, 50]

Experiment documentation updated: /home/ubuntu/CoTLab/outputs/2026-02-26/19-46-37_activation_patching_medgemma_27b_text_it_radiology_json_radiology/EXPERIMENT.md

Experiment complete.
