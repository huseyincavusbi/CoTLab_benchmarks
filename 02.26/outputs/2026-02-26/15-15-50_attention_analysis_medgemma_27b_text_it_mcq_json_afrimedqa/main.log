============================================================
Configuration:
============================================================
backend:
  _target_: cotlab.backends.TransformersBackend
  device: cuda
  dtype: bfloat16
  enable_hooks: true
  trust_remote_code: true
model:
  name: google/medgemma-27b-text-it
  variant: 27b-text
  max_new_tokens: 512
  temperature: 0.7
  top_p: 0.9
  safe_name: medgemma_27b_text_it
prompt:
  _target_: cotlab.prompts.mcq.MCQPromptStrategy
  name: mcq
  few_shot: true
  output_format: json
  answer_first: false
  contrarian: false
dataset:
  _target_: cotlab.datasets.loaders.MedQADataset
  name: afrimedqa
  filename: afrimedqa/mcq.jsonl
  split: mcq
experiment:
  _target_: cotlab.experiments.AttentionAnalysisExperiment
  name: attention_analysis
  description: Analyze attention patterns at critical layers
  all_layers: true
  target_layers: null
  layer_stride: 1
  force_eager_reload: false
  num_samples: null
  last_k_tokens: 16
  max_input_tokens: 1024
  analyze_generated_tokens: false
  generated_max_new_tokens: 16
  generated_do_sample: false
  generated_temperature: 0.7
  generated_top_p: 0.9
  question: Patient presents with chest pain, sweating, and shortness of breath. What
    is the diagnosis?
  batch_size: 16
seed: 42
verbose: true
dry_run: false

============================================================
Created experiment documentation: /root/CoTLab/CoTLab/outputs/2026-02-26/15-15-50_attention_analysis_medgemma_27b_text_it_mcq_json_afrimedqa/EXPERIMENT.md
Loading backend: cotlab.backends.TransformersBackend
Loading model: google/medgemma-27b-text-it
  Device map: cuda
  Dtype: torch.bfloat16
  Cache: ~/.cache/huggingface (HF default)
Loading checkpoint shards:   0%|                                           | 0/11 [00:00<?, ?it/s]Loading checkpoint shards:   9%|███▏                               | 1/11 [00:00<00:06,  1.46it/s]Loading checkpoint shards:  18%|██████▎                            | 2/11 [00:01<00:06,  1.43it/s]Loading checkpoint shards:  27%|█████████▌                         | 3/11 [00:02<00:05,  1.43it/s]Loading checkpoint shards:  36%|████████████▋                      | 4/11 [00:02<00:04,  1.42it/s]Loading checkpoint shards:  45%|███████████████▉                   | 5/11 [00:03<00:04,  1.42it/s]Loading checkpoint shards:  55%|███████████████████                | 6/11 [00:04<00:03,  1.41it/s]Loading checkpoint shards:  64%|██████████████████████▎            | 7/11 [00:04<00:02,  1.41it/s]Loading checkpoint shards:  73%|█████████████████████████▍         | 8/11 [00:05<00:02,  1.41it/s]Loading checkpoint shards:  82%|████████████████████████████▋      | 9/11 [00:06<00:01,  1.41it/s]Loading checkpoint shards:  91%|██████████████████████████████▉   | 10/11 [00:07<00:00,  1.41it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.44it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.43it/s]
  Resolved device: cuda:0
Creating prompt strategy: mcq
Loading dataset: afrimedqa
Creating experiment: attention_analysis
============================================================
Running experiment: attention_analysis
============================================================
Model: google/medgemma-27b-text-it
Attention heads: 32
All layers enabled: True
Layer stride: 1
Resolved layers: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61]
Max input tokens: 1024
Batch size: 16
Analyze generated tokens: False
Current attention implementation: sdpa
Switching attention implementation to 'eager' in-place...

Analyzing attention on 3958 samples (batch_size=16)...
Processing batches:   0%|                                                 | 0/248 [00:00<?, ?it/s]Processing batches:   0%|▏                                        | 1/248 [00:06<28:02,  6.81s/it]Processing batches:   1%|▎                                        | 2/248 [00:13<26:43,  6.52s/it]Processing batches:   1%|▍                                        | 3/248 [00:19<26:02,  6.38s/it]Processing batches:   2%|▋                                        | 4/248 [00:25<25:47,  6.34s/it]Processing batches:   2%|▊                                        | 5/248 [00:31<25:44,  6.35s/it]Processing batches:   2%|▉                                        | 6/248 [00:38<25:32,  6.33s/it]Processing batches:   3%|█▏                                       | 7/248 [00:44<25:27,  6.34s/it]Processing batches:   3%|█▎                                       | 8/248 [00:50<25:20,  6.34s/it]Processing batches:   4%|█▍                                       | 9/248 [00:57<25:19,  6.36s/it]Processing batches:   4%|█▌                                      | 10/248 [01:03<25:13,  6.36s/it]Processing batches:   4%|█▊                                      | 11/248 [01:10<25:10,  6.37s/it]Processing batches:   5%|█▉                                      | 12/248 [01:16<24:51,  6.32s/it]Processing batches:   5%|██                                      | 13/248 [01:22<24:48,  6.33s/it]Processing batches:   6%|██▎                                     | 14/248 [01:29<24:41,  6.33s/it]Processing batches:   6%|██▍                                     | 15/248 [01:35<24:34,  6.33s/it]Processing batches:   6%|██▌                                     | 16/248 [01:41<24:33,  6.35s/it]Processing batches:   7%|██▋                                     | 17/248 [01:48<24:35,  6.39s/it]Processing batches:   7%|██▉                                     | 18/248 [01:54<24:33,  6.41s/it]Processing batches:   8%|███                                     | 19/248 [02:01<24:29,  6.42s/it]Processing batches:   8%|███▏                                    | 20/248 [02:07<24:13,  6.37s/it]Processing batches:   8%|███▍                                    | 21/248 [02:13<24:00,  6.35s/it]Processing batches:   9%|███▌                                    | 22/248 [02:20<23:58,  6.36s/it]Processing batches:   9%|███▋                                    | 23/248 [02:26<23:52,  6.37s/it]Processing batches:  10%|███▊                                    | 24/248 [02:32<23:51,  6.39s/it]Processing batches:  10%|████                                    | 25/248 [02:39<23:39,  6.36s/it]Processing batches:  10%|████▏                                   | 26/248 [02:45<23:31,  6.36s/it]Processing batches:  11%|████▎                                   | 27/248 [02:51<23:26,  6.36s/it]Processing batches:  11%|████▌                                   | 28/248 [02:58<23:39,  6.45s/it]Processing batches:  12%|████▋                                   | 29/248 [03:05<23:35,  6.46s/it]Processing batches:  12%|████▊                                   | 30/248 [03:11<23:39,  6.51s/it]Processing batches:  12%|█████                                   | 31/248 [03:18<23:33,  6.52s/it]Processing batches:  13%|█████▏                                  | 32/248 [03:24<23:18,  6.47s/it]Processing batches:  13%|█████▎                                  | 33/248 [03:31<23:07,  6.45s/it]Processing batches:  14%|█████▍                                  | 34/248 [03:37<22:43,  6.37s/it]Processing batches:  14%|█████▋                                  | 35/248 [03:43<22:38,  6.38s/it]Processing batches:  15%|█████▊                                  | 36/248 [03:49<22:30,  6.37s/it]Processing batches:  15%|█████▉                                  | 37/248 [03:56<22:25,  6.38s/it]Processing batches:  15%|██████▏                                 | 38/248 [04:02<22:17,  6.37s/it]Processing batches:  16%|██████▎                                 | 39/248 [04:08<22:04,  6.34s/it]Processing batches:  16%|██████▍                                 | 40/248 [04:15<21:56,  6.33s/it]Processing batches:  17%|██████▌                                 | 41/248 [04:21<21:52,  6.34s/it]Processing batches:  17%|██████▊                                 | 42/248 [04:28<21:52,  6.37s/it]Processing batches:  17%|██████▉                                 | 43/248 [04:34<22:06,  6.47s/it]Processing batches:  18%|███████                                 | 44/248 [04:41<21:52,  6.44s/it]Processing batches:  18%|███████▎                                | 45/248 [04:47<21:42,  6.42s/it]Processing batches:  19%|███████▍                                | 46/248 [04:53<21:37,  6.42s/it]Processing batches:  19%|███████▌                                | 47/248 [05:00<21:25,  6.39s/it]Processing batches:  19%|███████▋                                | 48/248 [05:06<21:23,  6.42s/it]Processing batches:  20%|███████▉                                | 49/248 [05:13<21:31,  6.49s/it]Processing batches:  20%|████████                                | 50/248 [05:19<21:20,  6.47s/it]Processing batches:  21%|████████▏                               | 51/248 [05:26<21:06,  6.43s/it]Processing batches:  21%|████████▍                               | 52/248 [05:32<21:11,  6.49s/it]Processing batches:  21%|████████▌                               | 53/248 [05:39<21:00,  6.46s/it]Processing batches:  22%|████████▋                               | 54/248 [05:45<20:50,  6.44s/it]Processing batches:  22%|████████▊                               | 55/248 [05:51<20:38,  6.42s/it]Processing batches:  23%|█████████                               | 56/248 [05:58<20:26,  6.39s/it]Processing batches:  23%|█████████▏                              | 57/248 [06:04<20:14,  6.36s/it]Processing batches:  23%|█████████▎                              | 58/248 [06:11<20:15,  6.40s/it]Processing batches:  24%|█████████▌                              | 59/248 [06:17<20:05,  6.38s/it]Processing batches:  24%|█████████▋                              | 60/248 [06:23<19:55,  6.36s/it]Processing batches:  25%|█████████▊                              | 61/248 [06:29<19:45,  6.34s/it]Processing batches:  25%|██████████                              | 62/248 [06:36<19:41,  6.35s/it]Processing batches:  25%|██████████▏                             | 63/248 [06:42<19:33,  6.34s/it]Processing batches:  26%|██████████▎                             | 64/248 [06:49<19:28,  6.35s/it]Processing batches:  26%|██████████▍                             | 65/248 [06:55<19:20,  6.34s/it]Processing batches:  27%|██████████▋                             | 66/248 [07:01<19:09,  6.32s/it]Processing batches:  27%|██████████▊                             | 67/248 [07:07<19:04,  6.32s/it]Processing batches:  27%|██████████▉                             | 68/248 [07:14<19:00,  6.34s/it]Processing batches:  28%|███████████▏                            | 69/248 [07:20<18:58,  6.36s/it]Processing batches:  28%|███████████▎                            | 70/248 [07:27<18:52,  6.36s/it]Processing batches:  29%|███████████▍                            | 71/248 [07:33<18:45,  6.36s/it]Processing batches:  29%|███████████▌                            | 72/248 [07:39<18:36,  6.34s/it]Processing batches:  29%|███████████▊                            | 73/248 [07:46<18:29,  6.34s/it]Processing batches:  30%|███████████▉                            | 74/248 [07:52<18:24,  6.35s/it]Processing batches:  30%|████████████                            | 75/248 [07:58<18:15,  6.34s/it]Processing batches:  31%|████████████▎                           | 76/248 [08:05<18:39,  6.51s/it]Processing batches:  31%|████████████▍                           | 77/248 [08:11<18:17,  6.42s/it]Processing batches:  31%|████████████▌                           | 78/248 [08:18<18:02,  6.37s/it]Processing batches:  32%|████████████▋                           | 79/248 [08:24<17:49,  6.33s/it]Processing batches:  32%|████████████▉                           | 80/248 [08:30<17:47,  6.35s/it]Processing batches:  33%|█████████████                           | 81/248 [08:37<17:44,  6.38s/it]Processing batches:  33%|█████████████▏                          | 82/248 [08:43<17:35,  6.36s/it]Processing batches:  33%|█████████████▍                          | 83/248 [08:49<17:20,  6.31s/it]Processing batches:  34%|█████████████▌                          | 84/248 [08:55<17:10,  6.28s/it]Processing batches:  34%|█████████████▋                          | 85/248 [09:02<17:00,  6.26s/it]Processing batches:  35%|█████████████▊                          | 86/248 [09:08<16:53,  6.25s/it]Processing batches:  35%|██████████████                          | 87/248 [09:14<16:48,  6.26s/it]Processing batches:  35%|██████████████▏                         | 88/248 [09:20<16:40,  6.25s/it]Processing batches:  36%|██████████████▎                         | 89/248 [09:27<16:30,  6.23s/it]Processing batches:  36%|██████████████▌                         | 90/248 [09:33<16:23,  6.23s/it]Processing batches:  37%|██████████████▋                         | 91/248 [09:39<16:16,  6.22s/it]Processing batches:  37%|██████████████▊                         | 92/248 [09:45<16:09,  6.22s/it]Processing batches:  38%|███████████████                         | 93/248 [09:52<16:09,  6.26s/it]Processing batches:  38%|███████████████▏                        | 94/248 [09:58<16:06,  6.27s/it]Processing batches:  38%|███████████████▎                        | 95/248 [10:04<16:08,  6.33s/it]Processing batches:  39%|███████████████▍                        | 96/248 [10:11<16:02,  6.33s/it]Processing batches:  39%|███████████████▋                        | 97/248 [10:17<16:01,  6.37s/it]Processing batches:  40%|███████████████▊                        | 98/248 [10:24<15:57,  6.38s/it]Processing batches:  40%|███████████████▉                        | 99/248 [10:30<15:43,  6.33s/it]Processing batches:  40%|███████████████▋                       | 100/248 [10:36<15:39,  6.35s/it]Processing batches:  41%|███████████████▉                       | 101/248 [10:42<15:32,  6.35s/it]Processing batches:  41%|████████████████                       | 102/248 [10:49<15:29,  6.37s/it]Processing batches:  42%|████████████████▏                      | 103/248 [10:55<15:23,  6.37s/it]Processing batches:  42%|████████████████▎                      | 104/248 [11:02<15:31,  6.47s/it]Processing batches:  42%|████████████████▌                      | 105/248 [11:08<15:21,  6.44s/it]Processing batches:  43%|████████████████▋                      | 106/248 [11:15<15:11,  6.42s/it]Processing batches:  43%|████████████████▊                      | 107/248 [11:21<15:00,  6.39s/it]Processing batches:  44%|████████████████▉                      | 108/248 [11:27<14:54,  6.39s/it]Processing batches:  44%|█████████████████▏                     | 109/248 [11:34<14:44,  6.36s/it]Processing batches:  44%|█████████████████▎                     | 110/248 [11:40<14:41,  6.39s/it]Processing batches:  45%|█████████████████▍                     | 111/248 [11:47<14:35,  6.39s/it]Processing batches:  45%|█████████████████▌                     | 112/248 [11:53<14:25,  6.36s/it]Processing batches:  46%|█████████████████▊                     | 113/248 [11:59<14:19,  6.37s/it]Processing batches:  46%|█████████████████▉                     | 114/248 [12:05<14:08,  6.33s/it]Processing batches:  46%|██████████████████                     | 115/248 [12:12<14:28,  6.53s/it]Processing batches:  47%|██████████████████▏                    | 116/248 [12:19<14:22,  6.53s/it]Processing batches:  47%|██████████████████▍                    | 117/248 [12:25<14:08,  6.48s/it]Processing batches:  48%|██████████████████▌                    | 118/248 [12:32<13:57,  6.44s/it]Processing batches:  48%|██████████████████▋                    | 119/248 [12:38<13:44,  6.39s/it]Processing batches:  48%|██████████████████▊                    | 120/248 [12:44<13:41,  6.42s/it]Processing batches:  49%|███████████████████                    | 121/248 [12:51<13:28,  6.37s/it]Processing batches:  49%|███████████████████▏                   | 122/248 [12:57<13:25,  6.40s/it]Processing batches:  50%|███████████████████▎                   | 123/248 [13:04<13:21,  6.41s/it]Processing batches:  50%|███████████████████▌                   | 124/248 [13:10<13:16,  6.42s/it]Processing batches:  50%|███████████████████▋                   | 125/248 [13:16<13:09,  6.42s/it]Processing batches:  51%|███████████████████▊                   | 126/248 [13:23<13:01,  6.40s/it]Processing batches:  51%|███████████████████▉                   | 127/248 [13:29<12:50,  6.37s/it]Processing batches:  52%|████████████████████▏                  | 128/248 [13:35<12:40,  6.33s/it]Processing batches:  52%|████████████████████▎                  | 129/248 [13:42<12:39,  6.38s/it]Processing batches:  52%|████████████████████▍                  | 130/248 [13:48<12:34,  6.40s/it]Processing batches:  53%|████████████████████▌                  | 131/248 [13:55<12:32,  6.44s/it]Processing batches:  53%|████████████████████▊                  | 132/248 [14:01<12:24,  6.42s/it]Processing batches:  54%|████████████████████▉                  | 133/248 [14:08<12:18,  6.42s/it]Processing batches:  54%|█████████████████████                  | 134/248 [14:14<12:08,  6.39s/it]Processing batches:  54%|█████████████████████▏                 | 135/248 [14:20<12:01,  6.39s/it]Processing batches:  55%|█████████████████████▍                 | 136/248 [14:27<11:56,  6.40s/it]Processing batches:  55%|█████████████████████▌                 | 137/248 [14:33<11:43,  6.33s/it]Processing batches:  56%|█████████████████████▋                 | 138/248 [14:39<11:32,  6.30s/it]Processing batches:  56%|█████████████████████▊                 | 139/248 [14:46<11:28,  6.32s/it]Processing batches:  56%|██████████████████████                 | 140/248 [14:52<11:19,  6.29s/it]Processing batches:  57%|██████████████████████▏                | 141/248 [14:58<11:17,  6.33s/it]Processing batches:  57%|██████████████████████▎                | 142/248 [15:04<11:07,  6.30s/it]Processing batches:  58%|██████████████████████▍                | 143/248 [15:11<10:58,  6.27s/it]Processing batches:  58%|██████████████████████▋                | 144/248 [15:17<10:50,  6.26s/it]Processing batches:  58%|██████████████████████▊                | 145/248 [15:23<10:42,  6.24s/it]Processing batches:  59%|██████████████████████▉                | 146/248 [15:29<10:35,  6.23s/it]Processing batches:  59%|███████████████████████                | 147/248 [15:36<10:31,  6.25s/it]Processing batches:  60%|███████████████████████▎               | 148/248 [15:42<10:27,  6.28s/it]Processing batches:  60%|███████████████████████▍               | 149/248 [15:48<10:24,  6.31s/it]Processing batches:  60%|███████████████████████▌               | 150/248 [15:55<10:17,  6.30s/it]Processing batches:  61%|███████████████████████▋               | 151/248 [16:01<10:09,  6.29s/it]Processing batches:  61%|███████████████████████▉               | 152/248 [16:07<10:02,  6.28s/it]Processing batches:  62%|████████████████████████               | 153/248 [16:13<09:53,  6.25s/it]Processing batches:  62%|████████████████████████▏              | 154/248 [16:20<09:50,  6.29s/it]Processing batches:  62%|████████████████████████▍              | 155/248 [16:26<09:45,  6.30s/it]Processing batches:  63%|████████████████████████▌              | 156/248 [16:32<09:37,  6.28s/it]Processing batches:  63%|████████████████████████▋              | 157/248 [16:39<09:33,  6.30s/it]Processing batches:  64%|████████████████████████▊              | 158/248 [16:45<09:28,  6.32s/it]Processing batches:  64%|█████████████████████████              | 159/248 [16:51<09:24,  6.34s/it]Processing batches:  65%|█████████████████████████▏             | 160/248 [16:58<09:19,  6.35s/it]Processing batches:  65%|█████████████████████████▎             | 161/248 [17:04<09:12,  6.34s/it]Processing batches:  65%|█████████████████████████▍             | 162/248 [17:10<09:01,  6.30s/it]Processing batches:  66%|█████████████████████████▋             | 163/248 [17:16<08:53,  6.27s/it]Processing batches:  66%|█████████████████████████▊             | 164/248 [17:23<08:45,  6.25s/it]Processing batches:  67%|█████████████████████████▉             | 165/248 [17:30<08:55,  6.45s/it]Processing batches:  67%|██████████████████████████             | 166/248 [17:36<08:44,  6.39s/it]Processing batches:  67%|██████████████████████████▎            | 167/248 [17:42<08:34,  6.35s/it]Processing batches:  68%|██████████████████████████▍            | 168/248 [17:48<08:24,  6.30s/it]Processing batches:  68%|██████████████████████████▌            | 169/248 [17:54<08:15,  6.27s/it]Processing batches:  69%|██████████████████████████▋            | 170/248 [18:01<08:07,  6.24s/it]Processing batches:  69%|██████████████████████████▉            | 171/248 [18:07<08:00,  6.24s/it]Processing batches:  69%|███████████████████████████            | 172/248 [18:13<07:52,  6.22s/it]Processing batches:  70%|███████████████████████████▏           | 173/248 [18:19<07:45,  6.21s/it]Processing batches:  70%|███████████████████████████▎           | 174/248 [18:25<07:39,  6.20s/it]Processing batches:  71%|███████████████████████████▌           | 175/248 [18:32<07:32,  6.20s/it]Processing batches:  71%|███████████████████████████▋           | 176/248 [18:38<07:30,  6.26s/it]Processing batches:  71%|███████████████████████████▊           | 177/248 [18:44<07:23,  6.24s/it]Processing batches:  72%|███████████████████████████▉           | 178/248 [18:50<07:18,  6.26s/it]Processing batches:  72%|████████████████████████████▏          | 179/248 [18:57<07:20,  6.38s/it]Processing batches:  73%|████████████████████████████▎          | 180/248 [19:03<07:12,  6.36s/it]Processing batches:  73%|████████████████████████████▍          | 181/248 [19:10<07:16,  6.51s/it]Processing batches:  73%|████████████████████████████▌          | 182/248 [19:17<07:06,  6.47s/it]Processing batches:  74%|████████████████████████████▊          | 183/248 [19:23<06:56,  6.40s/it]Processing batches:  74%|████████████████████████████▉          | 184/248 [19:29<06:46,  6.35s/it]Processing batches:  75%|█████████████████████████████          | 185/248 [19:35<06:37,  6.31s/it]Processing batches:  75%|█████████████████████████████▎         | 186/248 [19:42<06:29,  6.28s/it]Processing batches:  75%|█████████████████████████████▍         | 187/248 [19:48<06:21,  6.25s/it]Processing batches:  76%|█████████████████████████████▌         | 188/248 [19:54<06:14,  6.24s/it]Processing batches:  76%|█████████████████████████████▋         | 189/248 [20:00<06:09,  6.26s/it]Processing batches:  77%|█████████████████████████████▉         | 190/248 [20:06<06:02,  6.24s/it]Processing batches:  77%|██████████████████████████████         | 191/248 [20:13<05:54,  6.23s/it]Processing batches:  77%|██████████████████████████████▏        | 192/248 [20:19<05:50,  6.25s/it]Processing batches:  78%|██████████████████████████████▎        | 193/248 [20:25<05:42,  6.24s/it]Processing batches:  78%|██████████████████████████████▌        | 194/248 [20:31<05:38,  6.27s/it]Processing batches:  79%|██████████████████████████████▋        | 195/248 [20:38<05:32,  6.27s/it]Processing batches:  79%|██████████████████████████████▊        | 196/248 [20:44<05:27,  6.29s/it]Processing batches:  79%|██████████████████████████████▉        | 197/248 [20:50<05:22,  6.32s/it]Processing batches:  80%|███████████████████████████████▏       | 198/248 [20:57<05:13,  6.27s/it]Processing batches:  80%|███████████████████████████████▎       | 199/248 [21:03<05:06,  6.25s/it]Processing batches:  81%|███████████████████████████████▍       | 200/248 [21:09<04:59,  6.24s/it]Processing batches:  81%|███████████████████████████████▌       | 201/248 [21:15<04:54,  6.27s/it]Processing batches:  81%|███████████████████████████████▊       | 202/248 [21:22<04:48,  6.28s/it]Processing batches:  82%|███████████████████████████████▉       | 203/248 [21:28<04:41,  6.26s/it]Processing batches:  82%|████████████████████████████████       | 204/248 [21:34<04:35,  6.25s/it]Processing batches:  83%|████████████████████████████████▏      | 205/248 [21:40<04:28,  6.25s/it]Processing batches:  83%|████████████████████████████████▍      | 206/248 [21:47<04:21,  6.22s/it]Processing batches:  83%|████████████████████████████████▌      | 207/248 [21:53<04:16,  6.26s/it]Processing batches:  84%|████████████████████████████████▋      | 208/248 [21:59<04:11,  6.28s/it]Processing batches:  84%|████████████████████████████████▊      | 209/248 [22:05<04:04,  6.27s/it]Processing batches:  85%|█████████████████████████████████      | 210/248 [22:12<04:00,  6.33s/it]Processing batches:  85%|█████████████████████████████████▏     | 211/248 [22:18<03:54,  6.33s/it]Processing batches:  85%|█████████████████████████████████▎     | 212/248 [22:24<03:46,  6.28s/it]Processing batches:  86%|█████████████████████████████████▍     | 213/248 [22:31<03:38,  6.25s/it]Processing batches:  86%|█████████████████████████████████▋     | 214/248 [22:37<03:32,  6.24s/it]Processing batches:  87%|█████████████████████████████████▊     | 215/248 [22:43<03:25,  6.23s/it]Processing batches:  87%|█████████████████████████████████▉     | 216/248 [22:49<03:19,  6.25s/it]Processing batches:  88%|██████████████████████████████████▏    | 217/248 [22:56<03:13,  6.25s/it]Processing batches:  88%|██████████████████████████████████▎    | 218/248 [23:02<03:07,  6.24s/it]Processing batches:  88%|██████████████████████████████████▍    | 219/248 [23:08<03:02,  6.28s/it]Processing batches:  89%|██████████████████████████████████▌    | 220/248 [23:14<02:55,  6.27s/it]Processing batches:  89%|██████████████████████████████████▊    | 221/248 [23:21<02:48,  6.25s/it]Processing batches:  90%|██████████████████████████████████▉    | 222/248 [23:27<02:42,  6.27s/it]Processing batches:  90%|███████████████████████████████████    | 223/248 [23:33<02:36,  6.26s/it]Processing batches:  90%|███████████████████████████████████▏   | 224/248 [23:40<02:31,  6.32s/it]Processing batches:  91%|███████████████████████████████████▍   | 225/248 [23:46<02:25,  6.32s/it]Processing batches:  91%|███████████████████████████████████▌   | 226/248 [23:53<02:24,  6.57s/it]Processing batches:  92%|███████████████████████████████████▋   | 227/248 [23:59<02:16,  6.49s/it]Processing batches:  92%|███████████████████████████████████▊   | 228/248 [24:06<02:08,  6.44s/it]Processing batches:  92%|████████████████████████████████████   | 229/248 [24:12<02:01,  6.38s/it]Processing batches:  93%|████████████████████████████████████▏  | 230/248 [24:18<01:53,  6.33s/it]Processing batches:  93%|████████████████████████████████████▎  | 231/248 [24:25<01:47,  6.33s/it]Processing batches:  94%|████████████████████████████████████▍  | 232/248 [24:31<01:41,  6.35s/it]Processing batches:  94%|████████████████████████████████████▋  | 233/248 [24:37<01:35,  6.36s/it]Processing batches:  94%|████████████████████████████████████▊  | 234/248 [24:44<01:29,  6.36s/it]Processing batches:  95%|████████████████████████████████████▉  | 235/248 [24:50<01:22,  6.36s/it]Processing batches:  95%|█████████████████████████████████████  | 236/248 [24:56<01:16,  6.36s/it]Processing batches:  96%|█████████████████████████████████████▎ | 237/248 [25:03<01:09,  6.33s/it]Processing batches:  96%|█████████████████████████████████████▍ | 238/248 [25:09<01:02,  6.28s/it]Processing batches:  96%|█████████████████████████████████████▌ | 239/248 [25:15<00:56,  6.31s/it]Processing batches:  97%|█████████████████████████████████████▋ | 240/248 [25:21<00:50,  6.31s/it]Processing batches:  97%|█████████████████████████████████████▉ | 241/248 [25:28<00:44,  6.31s/it]Processing batches:  98%|██████████████████████████████████████ | 242/248 [25:34<00:37,  6.32s/it]Processing batches:  98%|██████████████████████████████████████▏| 243/248 [25:40<00:31,  6.31s/it]Processing batches:  98%|██████████████████████████████████████▎| 244/248 [25:47<00:25,  6.34s/it]Processing batches:  99%|██████████████████████████████████████▌| 245/248 [25:53<00:19,  6.34s/it]Processing batches:  99%|██████████████████████████████████████▋| 246/248 [26:00<00:12,  6.34s/it]Processing batches: 100%|██████████████████████████████████████▊| 247/248 [26:06<00:06,  6.31s/it]Processing batches: 100%|███████████████████████████████████████| 248/248 [26:08<00:00,  5.14s/it]Processing batches: 100%|███████████████████████████████████████| 248/248 [26:08<00:00,  6.33s/it]

======================================================================
ATTENTION ANALYSIS: Aggregated Statistics Across Samples
======================================================================
Layer    | LastTok μ  | AllTok μ   | Last16 μ   | AllTok σ   | Top Tokens
----------------------------------------------------------------------------------------------------------
L0       | 3.5548     | 3.2510     | 4.0257     | 0.0365     | '.', ',', ' of'
L1       | 1.3753     | 1.3146     | 1.5306     | 0.0315     | ' ', '<bos>', '’'
L2       | 1.1098     | 1.2479     | 1.5869     | 0.0455     | ' ', '<bos>', '''
L3       | 0.2991     | 0.1987     | 0.3148     | 0.0239     | ' ', '<bos>', '''
L4       | 1.0039     | 0.8930     | 1.0840     | 0.0108     | ' ', '<bos>', '''
L5       | 1.4116     | 1.0304     | 1.2996     | 0.0135     | ' ', '<bos>', ' in'
L6       | 1.6412     | 1.3376     | 1.7375     | 0.0505     | ' ', '<bos>', '''
L7       | 1.8237     | 1.4271     | 1.7562     | 0.0254     | ' ', '<bos>', ' answer'
L8       | 1.9510     | 1.5956     | 1.8742     | 0.0312     | ' ', '<bos>', '''
L9       | 1.6742     | 1.4334     | 1.7635     | 0.0393     | '<bos>', ''', '

'
L10      | 2.1132     | 1.5046     | 2.1037     | 0.0426     | '<bos>', ''', ' '
L11      | 1.5250     | 1.3763     | 1.7838     | 0.0278     | ''', '<bos>', ' '
L12      | 1.5099     | 1.0641     | 1.5209     | 0.0603     | '<bos>', ''', ' '
L13      | 2.0777     | 1.3381     | 1.8222     | 0.0569     | '<bos>', ''', ' '
L14      | 2.0906     | 1.4238     | 1.8154     | 0.0468     | '.', ':', '
'
L15      | 2.1299     | 1.3648     | 1.8030     | 0.0408     | '<bos>', ''', ' '
L16      | 1.8753     | 1.5063     | 1.8216     | 0.0280     | '<bos>', ''', ' '
L17      | 2.5767     | 1.9311     | 2.4706     | 0.0283     | '<bos>', ' ', '''
L18      | 3.0474     | 2.4012     | 2.9995     | 0.0360     | '.', ' answer', ','
L19      | 2.5112     | 1.8510     | 2.3398     | 0.0343     | '<bos>', ''', ' '
L20      | 2.7925     | 2.0104     | 2.5965     | 0.0326     | '.', ' answer', ' D'
L21      | 2.8120     | 2.1841     | 2.6050     | 0.0346     | '.', ' answer', '```'
L22      | 3.0236     | 2.1884     | 2.6474     | 0.0316     | '.', ' answer', ' of'
L23      | 3.0285     | 2.4399     | 2.8516     | 0.0307     | '<bos>', '```', ' '
L24      | 3.3392     | 2.5186     | 3.1083     | 0.0271     | '.', ' answer', '"}'
L25      | 3.4346     | 2.6524     | 3.0431     | 0.0240     | '
', '.', ' answer'
L26      | 3.4616     | 2.6260     | 3.1642     | 0.0278     | '<bos>', '.', '```'
L27      | 3.2332     | 2.5710     | 2.9166     | 0.0349     | '.', ':', ' ...)'
L28      | 3.2507     | 2.5465     | 3.0317     | 0.0293     | '<bos>', ''', ' '
L29      | 2.7056     | 2.1216     | 2.6099     | 0.0258     | '<bos>', '```', 'Respond'
L30      | 2.6213     | 2.1714     | 2.5642     | 0.0347     | '<bos>', '",', ' '
L31      | 2.6074     | 1.9067     | 2.3122     | 0.0462     | '<bos>', '
', '```'
L32      | 2.3641     | 1.7063     | 2.1199     | 0.0496     | '<bos>', ' format', '
'
L33      | 2.5353     | 1.7271     | 2.1993     | 0.0506     | '<bos>', ' letter', 'Respond'
L34      | 2.0993     | 1.4827     | 1.8397     | 0.0530     | '<bos>', ' answer', '.'
L35      | 2.8274     | 1.9328     | 2.4611     | 0.0335     | '<bos>', '```', '
'
L36      | 2.4412     | 1.8570     | 2.1970     | 0.0473     | '.', '<bos>', '```'
L37      | 2.6152     | 1.7887     | 2.3762     | 0.0492     | '<bos>', 'answer', ' '
L38      | 2.0963     | 1.2905     | 1.6796     | 0.0604     | '.', '<bos>', ' answer'
L39      | 1.8692     | 1.1686     | 1.5006     | 0.0673     | '<bos>', ' "', '.'
L40      | 1.0713     | 0.4927     | 0.8817     | 0.0820     | '<bos>', ' answer', ' correct'
L41      | 1.6436     | 0.8405     | 1.3655     | 0.0444     | '<bos>', '##', ' '
L42      | 2.0290     | 1.1779     | 1.6206     | 0.0678     | '<bos>', 'json', ' answer'
L43      | 1.1206     | 0.7593     | 1.1602     | 0.0801     | '<bos>', ' the', ' correct'
L44      | 1.1356     | 0.7983     | 1.0908     | 0.0784     | '<bos>', '.', ','
L45      | 1.2454     | 0.7146     | 1.0618     | 0.0797     | '<bos>', ' "', '.'
L46      | 1.1206     | 0.8025     | 1.1918     | 0.0772     | '<bos>', '.', ' of'
L47      | 2.0707     | 1.2734     | 2.1410     | 0.0460     | '<bos>', '**', '.'
L48      | 0.8722     | 0.3979     | 0.9419     | 0.0905     | '<bos>', ' correct', ' '
L49      | 0.8345     | 0.3941     | 0.7950     | 0.0890     | '<bos>', ' answer', ' ...)'
L50      | 0.7236     | 0.4210     | 0.7763     | 0.0863     | '.', '<bos>', ' '
L51      | 1.0438     | 0.6294     | 1.0340     | 0.0801     | '<bos>', ' answer', ' '
L52      | 1.3932     | 0.9196     | 1.2626     | 0.0710     | '<bos>', ' answer', ' '
L53      | 2.1089     | 1.2200     | 1.8590     | 0.0493     | '
', '<bos>', '-'
L54      | 1.9041     | 1.4635     | 1.7979     | 0.0603     | '<bos>', ' answer', '```'
L55      | 2.1148     | 1.3351     | 1.8208     | 0.0649     | '<bos>', ''', '##'
L56      | 1.5971     | 1.1739     | 1.4587     | 0.0618     | '<bos>', ' answer', ' '
L57      | 0.9233     | 0.5563     | 0.8500     | 0.0698     | '<bos>', '.', ' letter'
L58      | 2.5243     | 1.6439     | 2.0549     | 0.0528     | '.', '<bos>', ' answer'
L59      | 2.3160     | 1.2283     | 1.8598     | 0.0400     | '<bos>', '

', '```'
L60      | 1.5088     | 1.1213     | 1.4218     | 0.0429     | '.', '<bos>', ' ...)'
L61      | 1.5426     | 1.2056     | 1.4290     | 0.0338     | '.', '<bos>', ' '
----------------------------------------------------------------------------------------------------------

Overall mean entropy (all tokens): 1.4669
Overall mean entropy (last token): 2.0210
Overall mean entropy (last 16 tokens): 1.8896
Most focused layer (all tokens): L3 (entropy: 0.1987)

Results saved to: /root/CoTLab/CoTLab/outputs/2026-02-26/15-15-50_attention_analysis_medgemma_27b_text_it_mcq_json_afrimedqa/results.json

Metrics:
  num_samples_analyzed: 3958
  num_layers_analyzed: 62
  num_heads: 32
  overall_mean_entropy: 1.466946029590841
  overall_mean_entropy_all_tokens: 1.466946029590841
  overall_mean_entropy_last_token: 2.0210233782377918
  overall_mean_entropy_last_k_tokens: 1.8895556699593716
  last_k_tokens: 16
  most_focused_layer: 3
  most_focused_entropy: 0.1986577058414006
  most_focused_layer_all_tokens: 3
  most_focused_entropy_all_tokens: 0.1986577058414006
  most_focused_layer_last_token: 3
  most_focused_entropy_last_token: 0.2991365169796791
  analyze_generated_tokens: False

Experiment documentation updated: /root/CoTLab/CoTLab/outputs/2026-02-26/15-15-50_attention_analysis_medgemma_27b_text_it_mcq_json_afrimedqa/EXPERIMENT.md

Experiment complete.
