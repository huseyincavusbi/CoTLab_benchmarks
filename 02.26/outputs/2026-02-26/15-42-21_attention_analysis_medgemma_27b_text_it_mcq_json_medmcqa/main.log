============================================================
Configuration:
============================================================
backend:
  _target_: cotlab.backends.TransformersBackend
  device: cuda
  dtype: bfloat16
  enable_hooks: true
  trust_remote_code: true
model:
  name: google/medgemma-27b-text-it
  variant: 27b-text
  max_new_tokens: 512
  temperature: 0.7
  top_p: 0.9
  safe_name: medgemma_27b_text_it
prompt:
  _target_: cotlab.prompts.mcq.MCQPromptStrategy
  name: mcq
  few_shot: true
  output_format: json
  answer_first: false
  contrarian: false
dataset:
  _target_: cotlab.datasets.loaders.MedQADataset
  name: medmcqa
  filename: medmcqa/validation.jsonl
  split: validation
experiment:
  _target_: cotlab.experiments.AttentionAnalysisExperiment
  name: attention_analysis
  description: Analyze attention patterns at critical layers
  all_layers: true
  target_layers: null
  layer_stride: 1
  force_eager_reload: false
  num_samples: null
  last_k_tokens: 16
  max_input_tokens: 1024
  analyze_generated_tokens: false
  generated_max_new_tokens: 16
  generated_do_sample: false
  generated_temperature: 0.7
  generated_top_p: 0.9
  question: Patient presents with chest pain, sweating, and shortness of breath. What
    is the diagnosis?
  batch_size: 16
seed: 42
verbose: true
dry_run: false

============================================================
Created experiment documentation: /root/CoTLab/CoTLab/outputs/2026-02-26/15-42-21_attention_analysis_medgemma_27b_text_it_mcq_json_medmcqa/EXPERIMENT.md
Loading backend: cotlab.backends.TransformersBackend
Loading model: google/medgemma-27b-text-it
  Device map: cuda
  Dtype: torch.bfloat16
  Cache: ~/.cache/huggingface (HF default)
Loading checkpoint shards:   0%|                                           | 0/11 [00:00<?, ?it/s]Loading checkpoint shards:   9%|███▏                               | 1/11 [00:00<00:06,  1.47it/s]Loading checkpoint shards:  18%|██████▎                            | 2/11 [00:01<00:06,  1.44it/s]Loading checkpoint shards:  27%|█████████▌                         | 3/11 [00:02<00:05,  1.43it/s]Loading checkpoint shards:  36%|████████████▋                      | 4/11 [00:02<00:04,  1.43it/s]Loading checkpoint shards:  45%|███████████████▉                   | 5/11 [00:03<00:04,  1.42it/s]Loading checkpoint shards:  55%|███████████████████                | 6/11 [00:04<00:03,  1.42it/s]Loading checkpoint shards:  64%|██████████████████████▎            | 7/11 [00:04<00:02,  1.42it/s]Loading checkpoint shards:  73%|█████████████████████████▍         | 8/11 [00:05<00:02,  1.42it/s]Loading checkpoint shards:  82%|████████████████████████████▋      | 9/11 [00:06<00:01,  1.42it/s]Loading checkpoint shards:  91%|██████████████████████████████▉   | 10/11 [00:07<00:00,  1.42it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.45it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.43it/s]
  Resolved device: cuda:0
Creating prompt strategy: mcq
Loading dataset: medmcqa
validation.jsonl: 0.00B [00:00, ?B/s]validation.jsonl: 1.32MB [00:00, 25.3MB/s]
Creating experiment: attention_analysis
============================================================
Running experiment: attention_analysis
============================================================
Model: google/medgemma-27b-text-it
Attention heads: 32
All layers enabled: True
Layer stride: 1
Resolved layers: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61]
Max input tokens: 1024
Batch size: 16
Analyze generated tokens: False
Current attention implementation: sdpa
Switching attention implementation to 'eager' in-place...

Analyzing attention on 4183 samples (batch_size=16)...
Processing batches:   0%|                                                 | 0/262 [00:00<?, ?it/s]Processing batches:   0%|▏                                        | 1/262 [00:06<28:59,  6.66s/it]Processing batches:   1%|▎                                        | 2/262 [00:12<27:39,  6.38s/it]Processing batches:   1%|▍                                        | 3/262 [00:19<27:16,  6.32s/it]Processing batches:   2%|▋                                        | 4/262 [00:25<26:57,  6.27s/it]Processing batches:   2%|▊                                        | 5/262 [00:31<26:43,  6.24s/it]Processing batches:   2%|▉                                        | 6/262 [00:37<26:34,  6.23s/it]Processing batches:   3%|█                                        | 7/262 [00:43<26:23,  6.21s/it]Processing batches:   3%|█▎                                       | 8/262 [00:49<26:10,  6.18s/it]Processing batches:   3%|█▍                                       | 9/262 [00:56<26:15,  6.23s/it]Processing batches:   4%|█▌                                      | 10/262 [01:02<26:06,  6.22s/it]Processing batches:   4%|█▋                                      | 11/262 [01:08<25:58,  6.21s/it]Processing batches:   5%|█▊                                      | 12/262 [01:14<25:52,  6.21s/it]Processing batches:   5%|█▉                                      | 13/262 [01:21<25:51,  6.23s/it]Processing batches:   5%|██▏                                     | 14/262 [01:27<25:50,  6.25s/it]Processing batches:   6%|██▎                                     | 15/262 [01:33<25:41,  6.24s/it]Processing batches:   6%|██▍                                     | 16/262 [01:39<25:27,  6.21s/it]Processing batches:   6%|██▌                                     | 17/262 [01:46<25:31,  6.25s/it]Processing batches:   7%|██▋                                     | 18/262 [01:52<25:51,  6.36s/it]Processing batches:   7%|██▉                                     | 19/262 [01:58<25:30,  6.30s/it]Processing batches:   8%|███                                     | 20/262 [02:05<25:16,  6.27s/it]Processing batches:   8%|███▏                                    | 21/262 [02:11<25:01,  6.23s/it]Processing batches:   8%|███▎                                    | 22/262 [02:17<24:51,  6.22s/it]Processing batches:   9%|███▌                                    | 23/262 [02:23<24:51,  6.24s/it]Processing batches:   9%|███▋                                    | 24/262 [02:30<24:46,  6.25s/it]Processing batches:  10%|███▊                                    | 25/262 [02:36<24:32,  6.21s/it]Processing batches:  10%|███▉                                    | 26/262 [02:42<24:23,  6.20s/it]Processing batches:  10%|████                                    | 27/262 [02:48<24:15,  6.19s/it]Processing batches:  11%|████▎                                   | 28/262 [02:54<24:19,  6.24s/it]Processing batches:  11%|████▍                                   | 29/262 [03:00<24:05,  6.20s/it]Processing batches:  11%|████▌                                   | 30/262 [03:07<23:57,  6.20s/it]Processing batches:  12%|████▋                                   | 31/262 [03:13<24:00,  6.24s/it]Processing batches:  12%|████▉                                   | 32/262 [03:19<23:51,  6.22s/it]Processing batches:  13%|█████                                   | 33/262 [03:25<23:44,  6.22s/it]Processing batches:  13%|█████▏                                  | 34/262 [03:32<23:47,  6.26s/it]Processing batches:  13%|█████▎                                  | 35/262 [03:38<23:30,  6.21s/it]Processing batches:  14%|█████▍                                  | 36/262 [03:44<23:21,  6.20s/it]Processing batches:  14%|█████▋                                  | 37/262 [03:50<23:15,  6.20s/it]Processing batches:  15%|█████▊                                  | 38/262 [03:57<23:18,  6.24s/it]Processing batches:  15%|█████▉                                  | 39/262 [04:03<23:05,  6.21s/it]Processing batches:  15%|██████                                  | 40/262 [04:09<22:56,  6.20s/it]Processing batches:  16%|██████▎                                 | 41/262 [04:15<22:49,  6.20s/it]Processing batches:  16%|██████▍                                 | 42/262 [04:21<22:42,  6.19s/it]Processing batches:  16%|██████▌                                 | 43/262 [04:28<22:52,  6.27s/it]Processing batches:  17%|██████▋                                 | 44/262 [04:34<22:52,  6.29s/it]Processing batches:  17%|██████▊                                 | 45/262 [04:40<22:39,  6.27s/it]Processing batches:  18%|███████                                 | 46/262 [04:46<22:25,  6.23s/it]Processing batches:  18%|███████▏                                | 47/262 [04:53<22:25,  6.26s/it]Processing batches:  18%|███████▎                                | 48/262 [04:59<22:19,  6.26s/it]Processing batches:  19%|███████▍                                | 49/262 [05:05<22:18,  6.28s/it]Processing batches:  19%|███████▋                                | 50/262 [05:12<22:11,  6.28s/it]Processing batches:  19%|███████▊                                | 51/262 [05:18<22:04,  6.28s/it]Processing batches:  20%|███████▉                                | 52/262 [05:24<21:48,  6.23s/it]Processing batches:  20%|████████                                | 53/262 [05:30<21:44,  6.24s/it]Processing batches:  21%|████████▏                               | 54/262 [05:37<21:40,  6.25s/it]Processing batches:  21%|████████▍                               | 55/262 [05:43<21:37,  6.27s/it]Processing batches:  21%|████████▌                               | 56/262 [05:49<21:26,  6.24s/it]Processing batches:  22%|████████▋                               | 57/262 [05:55<21:21,  6.25s/it]Processing batches:  22%|████████▊                               | 58/262 [06:01<21:12,  6.24s/it]Processing batches:  23%|█████████                               | 59/262 [06:08<20:56,  6.19s/it]Processing batches:  23%|█████████▏                              | 60/262 [06:14<20:47,  6.17s/it]Processing batches:  23%|█████████▎                              | 61/262 [06:20<20:40,  6.17s/it]Processing batches:  24%|█████████▍                              | 62/262 [06:26<20:33,  6.17s/it]Processing batches:  24%|█████████▌                              | 63/262 [06:32<20:27,  6.17s/it]Processing batches:  24%|█████████▊                              | 64/262 [06:38<20:20,  6.16s/it]Processing batches:  25%|█████████▉                              | 65/262 [06:44<20:12,  6.15s/it]Processing batches:  25%|██████████                              | 66/262 [06:51<20:13,  6.19s/it]Processing batches:  26%|██████████▏                             | 67/262 [06:57<20:03,  6.17s/it]Processing batches:  26%|██████████▍                             | 68/262 [07:03<19:58,  6.18s/it]Processing batches:  26%|██████████▌                             | 69/262 [07:09<19:50,  6.17s/it]Processing batches:  27%|██████████▋                             | 70/262 [07:15<19:48,  6.19s/it]Processing batches:  27%|██████████▊                             | 71/262 [07:22<19:40,  6.18s/it]Processing batches:  27%|██████████▉                             | 72/262 [07:28<19:33,  6.17s/it]Processing batches:  28%|███████████▏                            | 73/262 [07:34<19:30,  6.19s/it]Processing batches:  28%|███████████▎                            | 74/262 [07:40<19:21,  6.18s/it]Processing batches:  29%|███████████▍                            | 75/262 [07:46<19:11,  6.16s/it]Processing batches:  29%|███████████▌                            | 76/262 [07:53<19:28,  6.28s/it]Processing batches:  29%|███████████▊                            | 77/262 [07:59<19:16,  6.25s/it]Processing batches:  30%|███████████▉                            | 78/262 [08:05<19:08,  6.24s/it]Processing batches:  30%|████████████                            | 79/262 [08:11<18:56,  6.21s/it]Processing batches:  31%|████████████▏                           | 80/262 [08:18<18:47,  6.20s/it]Processing batches:  31%|████████████▎                           | 81/262 [08:24<18:39,  6.19s/it]Processing batches:  31%|████████████▌                           | 82/262 [08:30<18:38,  6.21s/it]Processing batches:  32%|████████████▋                           | 83/262 [08:36<18:32,  6.21s/it]Processing batches:  32%|████████████▊                           | 84/262 [08:42<18:23,  6.20s/it]Processing batches:  32%|████████████▉                           | 85/262 [08:49<18:23,  6.24s/it]Processing batches:  33%|█████████████▏                          | 86/262 [08:55<18:17,  6.24s/it]Processing batches:  33%|█████████████▎                          | 87/262 [09:01<18:08,  6.22s/it]Processing batches:  34%|█████████████▍                          | 88/262 [09:07<17:55,  6.18s/it]Processing batches:  34%|█████████████▌                          | 89/262 [09:13<17:46,  6.16s/it]Processing batches:  34%|█████████████▋                          | 90/262 [09:19<17:39,  6.16s/it]Processing batches:  35%|█████████████▉                          | 91/262 [09:26<17:31,  6.15s/it]Processing batches:  35%|██████████████                          | 92/262 [09:32<17:24,  6.14s/it]Processing batches:  35%|██████████████▏                         | 93/262 [09:38<17:15,  6.13s/it]Processing batches:  36%|██████████████▎                         | 94/262 [09:44<17:10,  6.13s/it]Processing batches:  36%|██████████████▌                         | 95/262 [09:50<17:07,  6.15s/it]Processing batches:  37%|██████████████▋                         | 96/262 [09:56<17:05,  6.18s/it]Processing batches:  37%|██████████████▊                         | 97/262 [10:03<16:58,  6.17s/it]Processing batches:  37%|██████████████▉                         | 98/262 [10:09<16:52,  6.17s/it]Processing batches:  38%|███████████████                         | 99/262 [10:15<16:47,  6.18s/it]Processing batches:  38%|██████████████▉                        | 100/262 [10:21<16:39,  6.17s/it]Processing batches:  39%|███████████████                        | 101/262 [10:27<16:33,  6.17s/it]Processing batches:  39%|███████████████▏                       | 102/262 [10:33<16:24,  6.16s/it]Processing batches:  39%|███████████████▎                       | 103/262 [10:40<16:18,  6.15s/it]Processing batches:  40%|███████████████▍                       | 104/262 [10:46<16:11,  6.15s/it]Processing batches:  40%|███████████████▋                       | 105/262 [10:52<16:05,  6.15s/it]Processing batches:  40%|███████████████▊                       | 106/262 [10:58<16:03,  6.17s/it]Processing batches:  41%|███████████████▉                       | 107/262 [11:04<15:54,  6.16s/it]Processing batches:  41%|████████████████                       | 108/262 [11:10<15:49,  6.17s/it]Processing batches:  42%|████████████████▏                      | 109/262 [11:17<15:50,  6.21s/it]Processing batches:  42%|████████████████▎                      | 110/262 [11:23<15:43,  6.21s/it]Processing batches:  42%|████████████████▌                      | 111/262 [11:29<15:33,  6.19s/it]Processing batches:  43%|████████████████▋                      | 112/262 [11:35<15:26,  6.18s/it]Processing batches:  43%|████████████████▊                      | 113/262 [11:41<15:19,  6.17s/it]Processing batches:  44%|████████████████▉                      | 114/262 [11:47<15:13,  6.17s/it]Processing batches:  44%|█████████████████                      | 115/262 [11:54<15:29,  6.33s/it]Processing batches:  44%|█████████████████▎                     | 116/262 [12:00<15:21,  6.31s/it]Processing batches:  45%|█████████████████▍                     | 117/262 [12:07<15:20,  6.35s/it]Processing batches:  45%|█████████████████▌                     | 118/262 [12:13<15:06,  6.29s/it]Processing batches:  45%|█████████████████▋                     | 119/262 [12:19<14:52,  6.24s/it]Processing batches:  46%|█████████████████▊                     | 120/262 [12:25<14:43,  6.22s/it]Processing batches:  46%|██████████████████                     | 121/262 [12:31<14:33,  6.20s/it]Processing batches:  47%|██████████████████▏                    | 122/262 [12:38<14:29,  6.21s/it]Processing batches:  47%|██████████████████▎                    | 123/262 [12:44<14:28,  6.25s/it]Processing batches:  47%|██████████████████▍                    | 124/262 [12:50<14:20,  6.24s/it]Processing batches:  48%|██████████████████▌                    | 125/262 [12:56<14:11,  6.22s/it]Processing batches:  48%|██████████████████▊                    | 126/262 [13:03<14:02,  6.19s/it]Processing batches:  48%|██████████████████▉                    | 127/262 [13:09<13:58,  6.21s/it]Processing batches:  49%|███████████████████                    | 128/262 [13:15<13:51,  6.20s/it]Processing batches:  49%|███████████████████▏                   | 129/262 [13:21<13:43,  6.19s/it]Processing batches:  50%|███████████████████▎                   | 130/262 [13:27<13:37,  6.20s/it]Processing batches:  50%|███████████████████▌                   | 131/262 [13:34<13:33,  6.21s/it]Processing batches:  50%|███████████████████▋                   | 132/262 [13:40<13:28,  6.22s/it]Processing batches:  51%|███████████████████▊                   | 133/262 [13:46<13:27,  6.26s/it]Processing batches:  51%|███████████████████▉                   | 134/262 [13:53<13:23,  6.28s/it]Processing batches:  52%|████████████████████                   | 135/262 [13:59<13:19,  6.30s/it]Processing batches:  52%|████████████████████▏                  | 136/262 [14:05<13:12,  6.29s/it]Processing batches:  52%|████████████████████▍                  | 137/262 [14:12<13:09,  6.32s/it]Processing batches:  53%|████████████████████▌                  | 138/262 [14:18<13:03,  6.32s/it]Processing batches:  53%|████████████████████▋                  | 139/262 [14:24<12:57,  6.32s/it]Processing batches:  53%|████████████████████▊                  | 140/262 [14:30<12:49,  6.30s/it]Processing batches:  54%|████████████████████▉                  | 141/262 [14:37<12:42,  6.30s/it]Processing batches:  54%|█████████████████████▏                 | 142/262 [14:43<12:34,  6.29s/it]Processing batches:  55%|█████████████████████▎                 | 143/262 [14:49<12:27,  6.28s/it]Processing batches:  55%|█████████████████████▍                 | 144/262 [14:56<12:20,  6.28s/it]Processing batches:  55%|█████████████████████▌                 | 145/262 [15:02<12:13,  6.27s/it]Processing batches:  56%|█████████████████████▋                 | 146/262 [15:08<12:14,  6.33s/it]Processing batches:  56%|█████████████████████▉                 | 147/262 [15:15<12:06,  6.32s/it]Processing batches:  56%|██████████████████████                 | 148/262 [15:21<12:00,  6.32s/it]Processing batches:  57%|██████████████████████▏                | 149/262 [15:27<11:52,  6.30s/it]Processing batches:  57%|██████████████████████▎                | 150/262 [15:34<11:52,  6.36s/it]Processing batches:  58%|██████████████████████▍                | 151/262 [15:40<11:46,  6.37s/it]Processing batches:  58%|██████████████████████▋                | 152/262 [15:46<11:36,  6.33s/it]Processing batches:  58%|██████████████████████▊                | 153/262 [15:53<11:30,  6.33s/it]Processing batches:  59%|██████████████████████▉                | 154/262 [15:59<11:20,  6.30s/it]Processing batches:  59%|███████████████████████                | 155/262 [16:05<11:18,  6.34s/it]Processing batches:  60%|███████████████████████▏               | 156/262 [16:12<11:13,  6.35s/it]Processing batches:  60%|███████████████████████▎               | 157/262 [16:18<11:04,  6.33s/it]Processing batches:  60%|███████████████████████▌               | 158/262 [16:24<10:58,  6.33s/it]Processing batches:  61%|███████████████████████▋               | 159/262 [16:31<10:50,  6.32s/it]Processing batches:  61%|███████████████████████▊               | 160/262 [16:37<10:45,  6.33s/it]Processing batches:  61%|███████████████████████▉               | 161/262 [16:43<10:37,  6.31s/it]Processing batches:  62%|████████████████████████               | 162/262 [16:50<10:32,  6.32s/it]Processing batches:  62%|████████████████████████▎              | 163/262 [16:56<10:24,  6.31s/it]Processing batches:  63%|████████████████████████▍              | 164/262 [17:02<10:20,  6.33s/it]Processing batches:  63%|████████████████████████▌              | 165/262 [17:09<10:35,  6.55s/it]Processing batches:  63%|████████████████████████▋              | 166/262 [17:16<10:20,  6.46s/it]Processing batches:  64%|████████████████████████▊              | 167/262 [17:22<10:08,  6.40s/it]Processing batches:  64%|█████████████████████████              | 168/262 [17:28<09:58,  6.37s/it]Processing batches:  65%|█████████████████████████▏             | 169/262 [17:34<09:48,  6.33s/it]Processing batches:  65%|█████████████████████████▎             | 170/262 [17:41<09:40,  6.31s/it]Processing batches:  65%|█████████████████████████▍             | 171/262 [17:47<09:33,  6.30s/it]Processing batches:  66%|█████████████████████████▌             | 172/262 [17:53<09:29,  6.33s/it]Processing batches:  66%|█████████████████████████▊             | 173/262 [18:00<09:24,  6.34s/it]Processing batches:  66%|█████████████████████████▉             | 174/262 [18:06<09:17,  6.33s/it]Processing batches:  67%|██████████████████████████             | 175/262 [18:12<09:09,  6.32s/it]Processing batches:  67%|██████████████████████████▏            | 176/262 [18:19<09:04,  6.33s/it]Processing batches:  68%|██████████████████████████▎            | 177/262 [18:25<08:57,  6.32s/it]Processing batches:  68%|██████████████████████████▍            | 178/262 [18:31<08:53,  6.35s/it]Processing batches:  68%|██████████████████████████▋            | 179/262 [18:38<08:45,  6.33s/it]Processing batches:  69%|██████████████████████████▊            | 180/262 [18:44<08:38,  6.32s/it]Processing batches:  69%|██████████████████████████▉            | 181/262 [18:50<08:30,  6.31s/it]Processing batches:  69%|███████████████████████████            | 182/262 [18:57<08:26,  6.33s/it]Processing batches:  70%|███████████████████████████▏           | 183/262 [19:03<08:18,  6.31s/it]Processing batches:  70%|███████████████████████████▍           | 184/262 [19:09<08:12,  6.31s/it]Processing batches:  71%|███████████████████████████▌           | 185/262 [19:15<08:04,  6.29s/it]Processing batches:  71%|███████████████████████████▋           | 186/262 [19:22<07:57,  6.28s/it]Processing batches:  71%|███████████████████████████▊           | 187/262 [19:28<07:53,  6.31s/it]Processing batches:  72%|███████████████████████████▉           | 188/262 [19:34<07:45,  6.29s/it]Processing batches:  72%|████████████████████████████▏          | 189/262 [19:41<07:38,  6.29s/it]Processing batches:  73%|████████████████████████████▎          | 190/262 [19:47<07:30,  6.26s/it]Processing batches:  73%|████████████████████████████▍          | 191/262 [19:53<07:25,  6.28s/it]Processing batches:  73%|████████████████████████████▌          | 192/262 [19:59<07:18,  6.26s/it]Processing batches:  74%|████████████████████████████▋          | 193/262 [20:06<07:12,  6.27s/it]Processing batches:  74%|████████████████████████████▉          | 194/262 [20:12<07:08,  6.30s/it]Processing batches:  74%|█████████████████████████████          | 195/262 [20:18<07:00,  6.28s/it]Processing batches:  75%|█████████████████████████████▏         | 196/262 [20:24<06:54,  6.29s/it]Processing batches:  75%|█████████████████████████████▎         | 197/262 [20:31<06:47,  6.28s/it]Processing batches:  76%|█████████████████████████████▍         | 198/262 [20:37<06:45,  6.33s/it]Processing batches:  76%|█████████████████████████████▌         | 199/262 [20:43<06:38,  6.32s/it]Processing batches:  76%|█████████████████████████████▊         | 200/262 [20:50<06:32,  6.33s/it]Processing batches:  77%|█████████████████████████████▉         | 201/262 [20:56<06:24,  6.31s/it]Processing batches:  77%|██████████████████████████████         | 202/262 [21:02<06:18,  6.31s/it]Processing batches:  77%|██████████████████████████████▏        | 203/262 [21:09<06:11,  6.30s/it]Processing batches:  78%|██████████████████████████████▎        | 204/262 [21:15<06:04,  6.28s/it]Processing batches:  78%|██████████████████████████████▌        | 205/262 [21:21<05:58,  6.28s/it]Processing batches:  79%|██████████████████████████████▋        | 206/262 [21:28<05:53,  6.32s/it]Processing batches:  79%|██████████████████████████████▊        | 207/262 [21:34<05:46,  6.31s/it]Processing batches:  79%|██████████████████████████████▉        | 208/262 [21:40<05:39,  6.29s/it]Processing batches:  80%|███████████████████████████████        | 209/262 [21:46<05:33,  6.29s/it]Processing batches:  80%|███████████████████████████████▎       | 210/262 [21:53<05:28,  6.32s/it]Processing batches:  81%|███████████████████████████████▍       | 211/262 [21:59<05:23,  6.35s/it]Processing batches:  81%|███████████████████████████████▌       | 212/262 [22:06<05:18,  6.36s/it]Processing batches:  81%|███████████████████████████████▋       | 213/262 [22:12<05:09,  6.32s/it]Processing batches:  82%|███████████████████████████████▊       | 214/262 [22:18<05:02,  6.31s/it]Processing batches:  82%|████████████████████████████████       | 215/262 [22:24<04:57,  6.34s/it]Processing batches:  82%|████████████████████████████████▏      | 216/262 [22:31<04:49,  6.30s/it]Processing batches:  83%|████████████████████████████████▎      | 217/262 [22:37<04:42,  6.28s/it]Processing batches:  83%|████████████████████████████████▍      | 218/262 [22:43<04:35,  6.27s/it]Processing batches:  84%|████████████████████████████████▌      | 219/262 [22:50<04:31,  6.32s/it]Processing batches:  84%|████████████████████████████████▋      | 220/262 [22:56<04:25,  6.32s/it]Processing batches:  84%|████████████████████████████████▉      | 221/262 [23:02<04:17,  6.29s/it]Processing batches:  85%|█████████████████████████████████      | 222/262 [23:09<04:12,  6.31s/it]Processing batches:  85%|█████████████████████████████████▏     | 223/262 [23:15<04:06,  6.31s/it]Processing batches:  85%|█████████████████████████████████▎     | 224/262 [23:21<03:58,  6.29s/it]Processing batches:  86%|█████████████████████████████████▍     | 225/262 [23:27<03:53,  6.31s/it]Processing batches:  86%|█████████████████████████████████▋     | 226/262 [23:35<03:56,  6.58s/it]Processing batches:  87%|█████████████████████████████████▊     | 227/262 [23:41<03:46,  6.48s/it]Processing batches:  87%|█████████████████████████████████▉     | 228/262 [23:47<03:38,  6.43s/it]Processing batches:  87%|██████████████████████████████████     | 229/262 [23:54<03:31,  6.42s/it]Processing batches:  88%|██████████████████████████████████▏    | 230/262 [24:00<03:23,  6.37s/it]Processing batches:  88%|██████████████████████████████████▍    | 231/262 [24:06<03:16,  6.35s/it]Processing batches:  89%|██████████████████████████████████▌    | 232/262 [24:12<03:10,  6.34s/it]Processing batches:  89%|██████████████████████████████████▋    | 233/262 [24:19<03:04,  6.36s/it]Processing batches:  89%|██████████████████████████████████▊    | 234/262 [24:25<02:58,  6.38s/it]Processing batches:  90%|██████████████████████████████████▉    | 235/262 [24:31<02:50,  6.32s/it]Processing batches:  90%|███████████████████████████████████▏   | 236/262 [24:38<02:44,  6.32s/it]Processing batches:  90%|███████████████████████████████████▎   | 237/262 [24:44<02:37,  6.30s/it]Processing batches:  91%|███████████████████████████████████▍   | 238/262 [24:50<02:31,  6.33s/it]Processing batches:  91%|███████████████████████████████████▌   | 239/262 [24:57<02:25,  6.31s/it]Processing batches:  92%|███████████████████████████████████▋   | 240/262 [25:03<02:18,  6.30s/it]Processing batches:  92%|███████████████████████████████████▊   | 241/262 [25:09<02:12,  6.32s/it]Processing batches:  92%|████████████████████████████████████   | 242/262 [25:16<02:05,  6.29s/it]Processing batches:  93%|████████████████████████████████████▏  | 243/262 [25:22<01:59,  6.28s/it]Processing batches:  93%|████████████████████████████████████▎  | 244/262 [25:28<01:53,  6.28s/it]Processing batches:  94%|████████████████████████████████████▍  | 245/262 [25:34<01:46,  6.25s/it]Processing batches:  94%|████████████████████████████████████▌  | 246/262 [25:41<01:40,  6.26s/it]Processing batches:  94%|████████████████████████████████████▊  | 247/262 [25:47<01:34,  6.32s/it]Processing batches:  95%|████████████████████████████████████▉  | 248/262 [25:53<01:28,  6.30s/it]Processing batches:  95%|█████████████████████████████████████  | 249/262 [26:00<01:21,  6.31s/it]Processing batches:  95%|█████████████████████████████████████▏ | 250/262 [26:06<01:15,  6.31s/it]Processing batches:  96%|█████████████████████████████████████▎ | 251/262 [26:12<01:09,  6.31s/it]Processing batches:  96%|█████████████████████████████████████▌ | 252/262 [26:19<01:03,  6.31s/it]Processing batches:  97%|█████████████████████████████████████▋ | 253/262 [26:25<00:56,  6.31s/it]Processing batches:  97%|█████████████████████████████████████▊ | 254/262 [26:31<00:50,  6.30s/it]Processing batches:  97%|█████████████████████████████████████▉ | 255/262 [26:37<00:44,  6.30s/it]Processing batches:  98%|██████████████████████████████████████ | 256/262 [26:44<00:37,  6.30s/it]Processing batches:  98%|██████████████████████████████████████▎| 257/262 [26:50<00:31,  6.29s/it]Processing batches:  98%|██████████████████████████████████████▍| 258/262 [26:56<00:25,  6.31s/it]Processing batches:  99%|██████████████████████████████████████▌| 259/262 [27:03<00:18,  6.33s/it]Processing batches:  99%|██████████████████████████████████████▋| 260/262 [27:09<00:12,  6.32s/it]Processing batches: 100%|██████████████████████████████████████▊| 261/262 [27:15<00:06,  6.33s/it]Processing batches: 100%|███████████████████████████████████████| 262/262 [27:18<00:00,  5.26s/it]Processing batches: 100%|███████████████████████████████████████| 262/262 [27:18<00:00,  6.25s/it]

======================================================================
ATTENTION ANALYSIS: Aggregated Statistics Across Samples
======================================================================
Layer    | LastTok μ  | AllTok μ   | Last16 μ   | AllTok σ   | Top Tokens
----------------------------------------------------------------------------------------------------------
L0       | 3.5285     | 3.2268     | 3.9959     | 0.0234     | '.', ',', ' of'
L1       | 1.3591     | 1.2958     | 1.4916     | 0.0221     | ' ', '<bos>', '''
L2       | 1.0347     | 1.2272     | 1.5372     | 0.0357     | ' ', '<bos>', '''
L3       | 0.2643     | 0.1878     | 0.2915     | 0.0188     | ' ', '<bos>', '''
L4       | 0.9924     | 0.8865     | 1.0761     | 0.0062     | ' ', '<bos>', '''
L5       | 1.3963     | 1.0193     | 1.2883     | 0.0087     | ' ', '<bos>', ' in'
L6       | 1.5963     | 1.3088     | 1.6877     | 0.0395     | ' ', '<bos>', '''
L7       | 1.7882     | 1.4091     | 1.7238     | 0.0161     | ' ', '<bos>', '''
L8       | 1.9056     | 1.5747     | 1.8430     | 0.0205     | ' ', '<bos>', '''
L9       | 1.6161     | 1.4066     | 1.7032     | 0.0274     | ''', '<bos>', '

'
L10      | 2.0606     | 1.4776     | 2.0418     | 0.0317     | ''', '<bos>', '

'
L11      | 1.4795     | 1.3523     | 1.7348     | 0.0204     | ''', '<bos>', '##'
L12      | 1.4083     | 1.0286     | 1.4256     | 0.0449     | '<bos>', ''', ' D'
L13      | 1.9960     | 1.3027     | 1.7257     | 0.0414     | '<bos>', ''', 'Your'
L14      | 2.0315     | 1.3895     | 1.7340     | 0.0334     | ':', '.', '
'
L15      | 2.0670     | 1.3356     | 1.7232     | 0.0295     | ''', '<bos>', ' select'
L16      | 1.8385     | 1.4846     | 1.7772     | 0.0195     | '<bos>', ''', '

'
L17      | 2.5559     | 1.9052     | 2.4379     | 0.0209     | '<bos>', ' Instructions', '```'
L18      | 3.0135     | 2.3768     | 2.9484     | 0.0231     | '.', ' answer', ','
L19      | 2.4862     | 1.8247     | 2.2960     | 0.0236     | ''', '<bos>', ' JSON'
L20      | 2.7650     | 1.9871     | 2.5760     | 0.0231     | '.', ' answer', ' D'
L21      | 2.7890     | 2.1593     | 2.5708     | 0.0237     | '.', ' answer', '```'
L22      | 3.0058     | 2.1657     | 2.5947     | 0.0218     | '.', ' answer', ' of'
L23      | 2.9931     | 2.4123     | 2.8452     | 0.0215     | '<bos>', '```', '
'
L24      | 3.3038     | 2.4946     | 3.0527     | 0.0179     | '.', ' answer', '"}'
L25      | 3.4210     | 2.6338     | 2.9904     | 0.0155     | '
', '.', ' answer'
L26      | 3.4300     | 2.6054     | 3.1223     | 0.0187     | '<bos>', '```', '.'
L27      | 3.1898     | 2.5448     | 2.8357     | 0.0229     | '.', ':', ' ...)'
L28      | 3.2102     | 2.5260     | 2.9804     | 0.0186     | ''', '<bos>', 'Respond'
L29      | 2.7031     | 2.1043     | 2.6490     | 0.0171     | '<bos>', '```', 'Respond'
L30      | 2.5698     | 2.1523     | 2.5202     | 0.0215     | '<bos>', '",', '```'
L31      | 2.5377     | 1.8875     | 2.2607     | 0.0284     | '<bos>', '
', '```'
L32      | 2.2617     | 1.6789     | 2.0545     | 0.0318     | '<bos>', ' format', '
'
L33      | 2.4421     | 1.6953     | 2.1141     | 0.0322     | '<bos>', ' letter', 'Respond'
L34      | 2.0119     | 1.4540     | 1.7411     | 0.0341     | '<bos>', ' answer', '.'
L35      | 2.7901     | 1.9136     | 2.4705     | 0.0213     | '<bos>', ' ...)', '```'
L36      | 2.3741     | 1.8333     | 2.1390     | 0.0304     | '.', '<bos>', '```'
L37      | 2.5542     | 1.7641     | 2.3206     | 0.0317     | '<bos>', 'answer', ' is'
L38      | 2.0032     | 1.2576     | 1.5856     | 0.0394     | '.', '<bos>', ' answer'
L39      | 1.7655     | 1.1334     | 1.3711     | 0.0440     | '<bos>', ' "', '.'
L40      | 0.9384     | 0.4521     | 0.7487     | 0.0537     | '<bos>', ' answer', ' correct'
L41      | 1.5655     | 0.8169     | 1.3054     | 0.0294     | '<bos>', '##', '

'
L42      | 1.9326     | 1.1401     | 1.5014     | 0.0440     | '<bos>', ' answer', ' X'
L43      | 0.9870     | 0.7179     | 1.0303     | 0.0521     | '<bos>', ' correct', ' the'
L44      | 0.9932     | 0.7566     | 0.9466     | 0.0516     | '<bos>', '.', ','
L45      | 1.0975     | 0.6743     | 0.9120     | 0.0519     | '<bos>', ' "', '.'
L46      | 0.9662     | 0.7619     | 1.0383     | 0.0508     | '<bos>', ' of', '.'
L47      | 1.9561     | 1.2517     | 2.1084     | 0.0303     | '<bos>', '**', '.'
L48      | 0.6968     | 0.3498     | 0.8134     | 0.0599     | '<bos>', ' correct', ' the'
L49      | 0.6700     | 0.3474     | 0.6588     | 0.0584     | '<bos>', ' answer', ' of'
L50      | 0.5788     | 0.3767     | 0.6435     | 0.0570     | '.', '<bos>', ' answer'
L51      | 0.9058     | 0.5880     | 0.9022     | 0.0522     | '<bos>', ' X', 'X'
L52      | 1.2610     | 0.8829     | 1.1665     | 0.0469     | '<bos>', ' answer', ' of'
L53      | 2.0645     | 1.1912     | 1.8232     | 0.0327     | '
', '<bos>', '-'
L54      | 1.7890     | 1.4304     | 1.7039     | 0.0396     | '<bos>', ' answer', '```'
L55      | 1.9895     | 1.2974     | 1.7100     | 0.0432     | ''', '<bos>', '##'
L56      | 1.4927     | 1.1392     | 1.3674     | 0.0412     | '<bos>', ' answer', '##'
L57      | 0.8028     | 0.5187     | 0.7250     | 0.0468     | '<bos>', '.', ' C'
L58      | 2.4279     | 1.6125     | 1.9896     | 0.0348     | '.', '<bos>', ' answer'
L59      | 2.2576     | 1.1956     | 1.8201     | 0.0278     | '<bos>', '

', '```'
L60      | 1.4885     | 1.1022     | 1.3714     | 0.0307     | '.', '<bos>', ' ...)'
L61      | 1.4979     | 1.1898     | 1.3986     | 0.0246     | '.', '<bos>', '''
----------------------------------------------------------------------------------------------------------

Overall mean entropy (all tokens): 1.4390
Overall mean entropy (last token): 1.9500
Overall mean entropy (last 16 tokens): 1.8220
Most focused layer (all tokens): L3 (entropy: 0.1878)

Results saved to: /root/CoTLab/CoTLab/outputs/2026-02-26/15-42-21_attention_analysis_medgemma_27b_text_it_mcq_json_medmcqa/results.json

Metrics:
  num_samples_analyzed: 4183
  num_layers_analyzed: 62
  num_heads: 32
  overall_mean_entropy: 1.4389780230533733
  overall_mean_entropy_all_tokens: 1.4389780230533733
  overall_mean_entropy_last_token: 1.949981318909655
  overall_mean_entropy_last_k_tokens: 1.8219690534361224
  last_k_tokens: 16
  most_focused_layer: 3
  most_focused_entropy: 0.18781209620765746
  most_focused_layer_all_tokens: 3
  most_focused_entropy_all_tokens: 0.18781209620765746
  most_focused_layer_last_token: 3
  most_focused_entropy_last_token: 0.2643433317197414
  analyze_generated_tokens: False

Experiment documentation updated: /root/CoTLab/CoTLab/outputs/2026-02-26/15-42-21_attention_analysis_medgemma_27b_text_it_mcq_json_medmcqa/EXPERIMENT.md

Experiment complete.
