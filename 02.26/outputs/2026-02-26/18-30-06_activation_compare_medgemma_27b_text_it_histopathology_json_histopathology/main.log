============================================================
Configuration:
============================================================
backend:
  _target_: cotlab.backends.TransformersBackend
  device: cuda
  dtype: bfloat16
  enable_hooks: true
  trust_remote_code: true
model:
  name: google/medgemma-27b-text-it
  variant: 27b-text
  max_new_tokens: 512
  temperature: 0.7
  top_p: 0.9
  safe_name: medgemma_27b_text_it
prompt:
  _target_: cotlab.prompts.HistopathologyPromptStrategy
  name: histopathology
  output_format: json
  few_shot: true
  answer_first: false
  contrarian: false
dataset:
  _target_: cotlab.datasets.HistopathologyDataset
  name: histopathology
  path: data/histopathology.tsv
experiment:
  _target_: cotlab.experiments.ActivationCompareExperiment
  name: activation_compare
  description: Collect mean layer activations for representational comparison
  layer_stride: 1
  num_samples: null
  pooling: last_token
  max_input_tokens: 1024
  seed: 42
  answer_cue: '


    Answer:'
  batch_size: 4
seed: 42
verbose: true
dry_run: false

============================================================
Created experiment documentation: /home/ubuntu/CoTLab/outputs/2026-02-26/18-30-06_activation_compare_medgemma_27b_text_it_histopathology_json_histopathology/EXPERIMENT.md
Loading backend: cotlab.backends.TransformersBackend
Loading model: google/medgemma-27b-text-it
  Device map: cuda
  Dtype: torch.bfloat16
  Cache: ~/.cache/huggingface (HF default)
Loading checkpoint shards:   0%|                                           | 0/11 [00:00<?, ?it/s]Loading checkpoint shards:   9%|███▏                               | 1/11 [00:00<00:07,  1.42it/s]Loading checkpoint shards:  18%|██████▎                            | 2/11 [00:01<00:06,  1.40it/s]Loading checkpoint shards:  27%|█████████▌                         | 3/11 [00:02<00:05,  1.40it/s]Loading checkpoint shards:  36%|████████████▋                      | 4/11 [00:02<00:05,  1.39it/s]Loading checkpoint shards:  45%|███████████████▉                   | 5/11 [00:03<00:04,  1.42it/s]Loading checkpoint shards:  55%|███████████████████                | 6/11 [00:04<00:03,  1.43it/s]Loading checkpoint shards:  64%|██████████████████████▎            | 7/11 [00:04<00:02,  1.41it/s]Loading checkpoint shards:  73%|█████████████████████████▍         | 8/11 [00:05<00:02,  1.41it/s]Loading checkpoint shards:  82%|████████████████████████████▋      | 9/11 [00:06<00:01,  1.43it/s]Loading checkpoint shards:  91%|██████████████████████████████▉   | 10/11 [00:07<00:00,  1.44it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.47it/s]Loading checkpoint shards: 100%|██████████████████████████████████| 11/11 [00:07<00:00,  1.43it/s]
  Resolved device: cuda:0
Creating prompt strategy: histopathology
Loading dataset: histopathology
Creating experiment: activation_compare
============================================================
Running experiment: activation_compare
============================================================
Model : google/medgemma-27b-text-it
Layers (62): [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61]
Pooling: last_token
Batch size: 4
Samples: 600

Activation collect:   0%|                                                 | 0/150 [00:00<?, ?it/s]Activation collect:   1%|▎                                        | 1/150 [00:01<02:49,  1.14s/it]Activation collect:   1%|▌                                        | 2/150 [00:01<02:13,  1.11it/s]Activation collect:   2%|▊                                        | 3/150 [00:02<01:54,  1.28it/s]Activation collect:   3%|█                                        | 4/150 [00:03<01:53,  1.29it/s]Activation collect:   3%|█▎                                       | 5/150 [00:03<01:48,  1.34it/s]Activation collect:   4%|█▋                                       | 6/150 [00:04<01:43,  1.39it/s]Activation collect:   5%|█▉                                       | 7/150 [00:05<01:38,  1.44it/s]Activation collect:   5%|██▏                                      | 8/150 [00:05<01:37,  1.46it/s]Activation collect:   6%|██▍                                      | 9/150 [00:06<01:36,  1.46it/s]Activation collect:   7%|██▋                                     | 10/150 [00:07<01:29,  1.56it/s]Activation collect:   7%|██▉                                     | 11/150 [00:07<01:30,  1.54it/s]Activation collect:   8%|███▏                                    | 12/150 [00:08<01:27,  1.57it/s]Activation collect:   9%|███▍                                    | 13/150 [00:09<01:30,  1.51it/s]Activation collect:   9%|███▋                                    | 14/150 [00:09<01:26,  1.56it/s]Activation collect:  10%|████                                    | 15/150 [00:10<01:26,  1.55it/s]Activation collect:  11%|████▎                                   | 16/150 [00:11<01:27,  1.54it/s]Activation collect:  11%|████▌                                   | 17/150 [00:11<01:26,  1.53it/s]Activation collect:  12%|████▊                                   | 18/150 [00:12<01:24,  1.56it/s]Activation collect:  13%|█████                                   | 19/150 [00:13<01:27,  1.49it/s]Activation collect:  13%|█████▎                                  | 20/150 [00:13<01:27,  1.49it/s]Activation collect:  14%|█████▌                                  | 21/150 [00:14<01:24,  1.52it/s]Activation collect:  15%|█████▊                                  | 22/150 [00:15<01:24,  1.51it/s]Activation collect:  15%|██████▏                                 | 23/150 [00:15<01:27,  1.45it/s]Activation collect:  16%|██████▍                                 | 24/150 [00:16<01:20,  1.56it/s]Activation collect:  17%|██████▋                                 | 25/150 [00:16<01:19,  1.57it/s]Activation collect:  17%|██████▉                                 | 26/150 [00:17<01:17,  1.60it/s]Activation collect:  18%|███████▏                                | 27/150 [00:18<01:18,  1.56it/s]Activation collect:  19%|███████▍                                | 28/150 [00:18<01:15,  1.62it/s]Activation collect:  19%|███████▋                                | 29/150 [00:19<01:15,  1.60it/s]Activation collect:  20%|████████                                | 30/150 [00:20<01:16,  1.57it/s]Activation collect:  21%|████████▎                               | 31/150 [00:20<01:12,  1.64it/s]Activation collect:  21%|████████▌                               | 32/150 [00:21<01:13,  1.61it/s]Activation collect:  22%|████████▊                               | 33/150 [00:21<01:13,  1.59it/s]Activation collect:  23%|█████████                               | 34/150 [00:22<01:11,  1.62it/s]Activation collect:  23%|█████████▎                              | 35/150 [00:23<01:10,  1.63it/s]Activation collect:  24%|█████████▌                              | 36/150 [00:23<01:09,  1.65it/s]Activation collect:  25%|█████████▊                              | 37/150 [00:24<01:07,  1.68it/s]Activation collect:  25%|██████████▏                             | 38/150 [00:24<01:08,  1.64it/s]Activation collect:  26%|██████████▍                             | 39/150 [00:25<01:07,  1.65it/s]Activation collect:  27%|██████████▋                             | 40/150 [00:26<01:08,  1.60it/s]Activation collect:  27%|██████████▉                             | 41/150 [00:26<01:08,  1.59it/s]Activation collect:  28%|███████████▏                            | 42/150 [00:27<01:06,  1.63it/s]Activation collect:  29%|███████████▍                            | 43/150 [00:27<01:03,  1.69it/s]Activation collect:  29%|███████████▋                            | 44/150 [00:28<01:04,  1.65it/s]Activation collect:  30%|████████████                            | 45/150 [00:29<01:01,  1.70it/s]Activation collect:  31%|████████████▎                           | 46/150 [00:29<01:01,  1.69it/s]Activation collect:  31%|████████████▌                           | 47/150 [00:30<00:59,  1.73it/s]Activation collect:  32%|████████████▊                           | 48/150 [00:30<00:59,  1.72it/s]Activation collect:  33%|█████████████                           | 49/150 [00:31<01:00,  1.67it/s]Activation collect:  33%|█████████████▎                          | 50/150 [00:32<01:03,  1.58it/s]Activation collect:  34%|█████████████▌                          | 51/150 [00:32<01:00,  1.63it/s]Activation collect:  35%|█████████████▊                          | 52/150 [00:33<01:00,  1.63it/s]Activation collect:  35%|██████████████▏                         | 53/150 [00:34<00:58,  1.65it/s]Activation collect:  36%|██████████████▍                         | 54/150 [00:34<00:58,  1.65it/s]Activation collect:  37%|██████████████▋                         | 55/150 [00:35<00:58,  1.63it/s]Activation collect:  37%|██████████████▉                         | 56/150 [00:35<00:58,  1.60it/s]Activation collect:  38%|███████████████▏                        | 57/150 [00:36<00:58,  1.59it/s]Activation collect:  39%|███████████████▍                        | 58/150 [00:37<00:59,  1.56it/s]Activation collect:  39%|███████████████▋                        | 59/150 [00:37<00:56,  1.60it/s]Activation collect:  40%|████████████████                        | 60/150 [00:38<00:53,  1.68it/s]Activation collect:  41%|████████████████▎                       | 61/150 [00:39<00:55,  1.60it/s]Activation collect:  41%|████████████████▌                       | 62/150 [00:39<00:54,  1.62it/s]Activation collect:  42%|████████████████▊                       | 63/150 [00:40<00:53,  1.63it/s]Activation collect:  43%|█████████████████                       | 64/150 [00:40<00:50,  1.69it/s]Activation collect:  43%|█████████████████▎                      | 65/150 [00:41<00:49,  1.71it/s]Activation collect:  44%|█████████████████▌                      | 66/150 [00:42<00:52,  1.60it/s]Activation collect:  45%|█████████████████▊                      | 67/150 [00:42<00:51,  1.60it/s]Activation collect:  45%|██████████████████▏                     | 68/150 [00:43<00:54,  1.50it/s]Activation collect:  46%|██████████████████▍                     | 69/150 [00:44<00:53,  1.51it/s]Activation collect:  47%|██████████████████▋                     | 70/150 [00:44<00:53,  1.49it/s]Activation collect:  47%|██████████████████▉                     | 71/150 [00:45<00:49,  1.60it/s]Activation collect:  48%|███████████████████▏                    | 72/150 [00:45<00:48,  1.61it/s]Activation collect:  49%|███████████████████▍                    | 73/150 [00:46<00:48,  1.59it/s]Activation collect:  49%|███████████████████▋                    | 74/150 [00:47<00:47,  1.59it/s]Activation collect:  50%|████████████████████                    | 75/150 [00:47<00:46,  1.63it/s]Activation collect:  51%|████████████████████▎                   | 76/150 [00:48<00:46,  1.61it/s]Activation collect:  51%|████████████████████▌                   | 77/150 [00:49<00:45,  1.61it/s]Activation collect:  52%|████████████████████▊                   | 78/150 [00:49<00:45,  1.57it/s]Activation collect:  53%|█████████████████████                   | 79/150 [00:50<00:45,  1.56it/s]Activation collect:  53%|█████████████████████▎                  | 80/150 [00:50<00:43,  1.60it/s]Activation collect:  54%|█████████████████████▌                  | 81/150 [00:51<00:40,  1.69it/s]Activation collect:  55%|█████████████████████▊                  | 82/150 [00:52<00:41,  1.65it/s]Activation collect:  55%|██████████████████████▏                 | 83/150 [00:52<00:39,  1.68it/s]Activation collect:  56%|██████████████████████▍                 | 84/150 [00:53<00:40,  1.64it/s]Activation collect:  57%|██████████████████████▋                 | 85/150 [00:53<00:40,  1.62it/s]Activation collect:  57%|██████████████████████▉                 | 86/150 [00:54<00:40,  1.58it/s]Activation collect:  58%|███████████████████████▏                | 87/150 [00:55<00:38,  1.65it/s]Activation collect:  59%|███████████████████████▍                | 88/150 [00:55<00:38,  1.61it/s]Activation collect:  59%|███████████████████████▋                | 89/150 [00:56<00:37,  1.61it/s]Activation collect:  60%|████████████████████████                | 90/150 [00:57<00:36,  1.65it/s]Activation collect:  61%|████████████████████████▎               | 91/150 [00:57<00:36,  1.62it/s]Activation collect:  61%|████████████████████████▌               | 92/150 [00:58<00:35,  1.65it/s]Activation collect:  62%|████████████████████████▊               | 93/150 [00:58<00:35,  1.61it/s]Activation collect:  63%|█████████████████████████               | 94/150 [00:59<00:34,  1.63it/s]Activation collect:  63%|█████████████████████████▎              | 95/150 [01:00<00:33,  1.65it/s]Activation collect:  64%|█████████████████████████▌              | 96/150 [01:00<00:31,  1.71it/s]Activation collect:  65%|█████████████████████████▊              | 97/150 [01:01<00:30,  1.72it/s]Activation collect:  65%|██████████████████████████▏             | 98/150 [01:01<00:29,  1.75it/s]Activation collect:  66%|██████████████████████████▍             | 99/150 [01:02<00:28,  1.78it/s]Activation collect:  67%|██████████████████████████             | 100/150 [01:02<00:28,  1.77it/s]Activation collect:  67%|██████████████████████████▎            | 101/150 [01:03<00:28,  1.73it/s]Activation collect:  68%|██████████████████████████▌            | 102/150 [01:04<00:29,  1.64it/s]Activation collect:  69%|██████████████████████████▊            | 103/150 [01:04<00:29,  1.59it/s]Activation collect:  69%|███████████████████████████            | 104/150 [01:05<00:28,  1.60it/s]Activation collect:  70%|███████████████████████████▎           | 105/150 [01:06<00:27,  1.64it/s]Activation collect:  71%|███████████████████████████▌           | 106/150 [01:06<00:26,  1.69it/s]Activation collect:  71%|███████████████████████████▊           | 107/150 [01:07<00:25,  1.67it/s]Activation collect:  72%|████████████████████████████           | 108/150 [01:07<00:26,  1.59it/s]Activation collect:  73%|████████████████████████████▎          | 109/150 [01:08<00:25,  1.60it/s]Activation collect:  73%|████████████████████████████▌          | 110/150 [01:09<00:24,  1.66it/s]Activation collect:  74%|████████████████████████████▊          | 111/150 [01:09<00:23,  1.63it/s]Activation collect:  75%|█████████████████████████████          | 112/150 [01:10<00:23,  1.61it/s]Activation collect:  75%|█████████████████████████████▍         | 113/150 [01:10<00:21,  1.68it/s]Activation collect:  76%|█████████████████████████████▋         | 114/150 [01:11<00:21,  1.64it/s]Activation collect:  77%|█████████████████████████████▉         | 115/150 [01:12<00:21,  1.65it/s]Activation collect:  77%|██████████████████████████████▏        | 116/150 [01:12<00:20,  1.63it/s]Activation collect:  78%|██████████████████████████████▍        | 117/150 [01:13<00:19,  1.68it/s]Activation collect:  79%|██████████████████████████████▋        | 118/150 [01:13<00:18,  1.73it/s]Activation collect:  79%|██████████████████████████████▉        | 119/150 [01:14<00:18,  1.69it/s]Activation collect:  80%|███████████████████████████████▏       | 120/150 [01:15<00:18,  1.65it/s]Activation collect:  81%|███████████████████████████████▍       | 121/150 [01:15<00:19,  1.50it/s]Activation collect:  81%|███████████████████████████████▋       | 122/150 [01:16<00:19,  1.46it/s]Activation collect:  82%|███████████████████████████████▉       | 123/150 [01:17<00:17,  1.55it/s]Activation collect:  83%|████████████████████████████████▏      | 124/150 [01:17<00:17,  1.47it/s]Activation collect:  83%|████████████████████████████████▌      | 125/150 [01:18<00:15,  1.59it/s]Activation collect:  84%|████████████████████████████████▊      | 126/150 [01:19<00:15,  1.60it/s]Activation collect:  85%|█████████████████████████████████      | 127/150 [01:19<00:14,  1.57it/s]Activation collect:  85%|█████████████████████████████████▎     | 128/150 [01:20<00:13,  1.60it/s]Activation collect:  86%|█████████████████████████████████▌     | 129/150 [01:20<00:13,  1.59it/s]Activation collect:  87%|█████████████████████████████████▊     | 130/150 [01:21<00:12,  1.65it/s]Activation collect:  87%|██████████████████████████████████     | 131/150 [01:22<00:11,  1.66it/s]Activation collect:  88%|██████████████████████████████████▎    | 132/150 [01:22<00:11,  1.62it/s]Activation collect:  89%|██████████████████████████████████▌    | 133/150 [01:23<00:10,  1.61it/s]Activation collect:  89%|██████████████████████████████████▊    | 134/150 [01:23<00:09,  1.62it/s]Activation collect:  90%|███████████████████████████████████    | 135/150 [01:24<00:09,  1.65it/s]Activation collect:  91%|███████████████████████████████████▎   | 136/150 [01:25<00:08,  1.59it/s]Activation collect:  91%|███████████████████████████████████▌   | 137/150 [01:25<00:07,  1.66it/s]Activation collect:  92%|███████████████████████████████████▉   | 138/150 [01:26<00:07,  1.62it/s]Activation collect:  93%|████████████████████████████████████▏  | 139/150 [01:27<00:06,  1.67it/s]Activation collect:  93%|████████████████████████████████████▍  | 140/150 [01:27<00:05,  1.72it/s]Activation collect:  94%|████████████████████████████████████▋  | 141/150 [01:28<00:05,  1.71it/s]Activation collect:  95%|████████████████████████████████████▉  | 142/150 [01:28<00:04,  1.71it/s]Activation collect:  95%|█████████████████████████████████████▏ | 143/150 [01:29<00:04,  1.68it/s]Activation collect:  96%|█████████████████████████████████████▍ | 144/150 [01:29<00:03,  1.66it/s]Activation collect:  97%|█████████████████████████████████████▋ | 145/150 [01:30<00:02,  1.69it/s]Activation collect:  97%|█████████████████████████████████████▉ | 146/150 [01:31<00:02,  1.73it/s]Activation collect:  98%|██████████████████████████████████████▏| 147/150 [01:31<00:01,  1.72it/s]Activation collect:  99%|██████████████████████████████████████▍| 148/150 [01:32<00:01,  1.75it/s]Activation collect:  99%|██████████████████████████████████████▋| 149/150 [01:32<00:00,  1.62it/s]Activation collect: 100%|███████████████████████████████████████| 150/150 [01:33<00:00,  1.61it/s]Activation collect: 100%|███████████████████████████████████████| 150/150 [01:33<00:00,  1.60it/s]

============================================================
ACTIVATION COLLECT SUMMARY
============================================================
Processed samples : 600 / 600
 Layer        Norm         Std
--------------------------------
     0      227.49    0.031013
     1       26.04    0.006504
     2       57.48    0.007477
     3       55.16    0.018667
     4      393.25    0.012912
     5       90.19    0.004852
     6       66.47    0.020301
     7      212.75    0.025723
     8      742.64    0.046686
     9      809.31    0.069238
    10      315.70    0.073514
    11      314.06    0.102125
    12      143.26    0.077777
    13      440.52    0.093700
    14      219.29    0.098261
    15      837.60    0.147185
    16      531.90    0.154347
    17     1407.17    0.248614
    18      595.60    0.252166
    19      392.46    0.310625
    20      431.15    0.423448
    21     1298.77    0.532360
    22      654.14    0.631071
    23     1154.55    0.820436
    24     2761.74    1.103471
    25     1806.79    1.452078
    26     2558.82    1.863040
    27     3800.06    2.196258
    28     3309.38    2.395960
    29     2959.27    3.064520
    30     3815.44    2.916011
    31     2246.30    2.769018
    32     1999.79    2.918317
    33     2543.68    2.453048
    34     3577.15    2.994435
    35     3416.00    4.369248
    36     5053.97    4.811095
    37     4445.21    4.350133
    38     3372.21    4.368152
    39     4539.33    6.116529
    40     4348.49    5.539417
    41     3848.12    4.422741
    42     2901.58    5.354258
    43     4439.03    7.244401
    44     3830.62    6.254732
    45     4331.55    7.158988
    46     5467.99    8.300325
    47     2104.63    3.599183
    48     4597.14    7.235631
    49     4751.89    7.508961
    50     3914.72    7.395313
    51     2854.26    4.481635
    52     9456.54   13.725242
    53     6124.34   12.359491
    54     5166.51    8.813706
    55    13167.53   19.613432
    56    13154.95   20.796139
    57    18244.15   31.119783
    58    20445.66   37.166214
    59    15468.91   31.898380
    60    12582.55   26.313864
    61    39235.70   16.573664
============================================================

Results saved to: /home/ubuntu/CoTLab/outputs/2026-02-26/18-30-06_activation_compare_medgemma_27b_text_it_histopathology_json_histopathology/results.json

Metrics:
  num_samples: 600
  pooling: last_token
  layer_stride: 1
  activation_norms: {0: 227.4877, 1: 26.0404, 2: 57.4777, 3: 55.1634, 4: 393.2486, 5: 90.1911, 6: 66.4723, 7: 212.7512, 8: 742.6447, 9: 809.3125, 10: 315.6959, 11: 314.0569, 12: 143.2564, 13: 440.517, 14: 219.293, 15: 837.5958, 16: 531.8976, 17: 1407.1741, 18: 595.5952, 19: 392.4558, 20: 431.1451, 21: 1298.7667, 22: 654.1371, 23: 1154.551, 24: 2761.7363, 25: 1806.7908, 26: 2558.8164, 27: 3800.061, 28: 3309.3767, 29: 2959.2683, 30: 3815.4404, 31: 2246.304, 32: 1999.7861, 33: 2543.6809, 34: 3577.1489, 35: 3416.0027, 36: 5053.9712, 37: 4445.209, 38: 3372.2061, 39: 4539.3271, 40: 4348.4868, 41: 3848.1245, 42: 2901.5803, 43: 4439.0293, 44: 3830.6196, 45: 4331.5527, 46: 5467.9927, 47: 2104.6311, 48: 4597.1382, 49: 4751.8911, 50: 3914.7227, 51: 2854.2644, 52: 9456.5371, 53: 6124.3438, 54: 5166.5132, 55: 13167.5273, 56: 13154.9541, 57: 18244.1543, 58: 20445.6641, 59: 15468.9082, 60: 12582.5508, 61: 39235.7031}
  activation_std: {0: 0.031013, 1: 0.006504, 2: 0.007477, 3: 0.018667, 4: 0.012912, 5: 0.004852, 6: 0.020301, 7: 0.025723, 8: 0.046686, 9: 0.069238, 10: 0.073514, 11: 0.102125, 12: 0.077777, 13: 0.0937, 14: 0.098261, 15: 0.147185, 16: 0.154347, 17: 0.248614, 18: 0.252166, 19: 0.310625, 20: 0.423448, 21: 0.53236, 22: 0.631071, 23: 0.820436, 24: 1.103471, 25: 1.452078, 26: 1.86304, 27: 2.196258, 28: 2.39596, 29: 3.06452, 30: 2.916011, 31: 2.769018, 32: 2.918317, 33: 2.453048, 34: 2.994435, 35: 4.369248, 36: 4.811095, 37: 4.350133, 38: 4.368152, 39: 6.116529, 40: 5.539417, 41: 4.422741, 42: 5.354258, 43: 7.244401, 44: 6.254732, 45: 7.158988, 46: 8.300325, 47: 3.599183, 48: 7.235631, 49: 7.508961, 50: 7.395313, 51: 4.481635, 52: 13.725242, 53: 12.359491, 54: 8.813706, 55: 19.613432, 56: 20.796139, 57: 31.119783, 58: 37.166214, 59: 31.89838, 60: 26.313864, 61: 16.573664}

Experiment documentation updated: /home/ubuntu/CoTLab/outputs/2026-02-26/18-30-06_activation_compare_medgemma_27b_text_it_histopathology_json_histopathology/EXPERIMENT.md

Experiment complete.
